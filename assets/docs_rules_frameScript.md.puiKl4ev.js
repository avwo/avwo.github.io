import{_ as a}from"./chunks/frame-script.DbFYyweK.js";import{_ as e,c as s,o as n,ag as d}from"./chunks/framework.Bw-5EFTY.js";const m=JSON.parse('{"title":"frameScript","description":"","frontmatter":{},"headers":[],"relativePath":"docs/rules/frameScript.md","filePath":"docs/rules/frameScript.md"}'),r={name:"docs/rules/frameScript.md"};function p(o,t,c,l,i,h){return n(),s("div",null,t[0]||(t[0]=[d(`<h1 id="framescript" tabindex="-1">frameScript <a class="header-anchor" href="#framescript" aria-label="Permalink to &quot;frameScript&quot;">​</a></h1><p>通过 JavaScript 脚本操作 WebSocket 和普通 TCP 请求数据帧。</p><h2 id="规则语法" tabindex="-1">规则语法 <a class="header-anchor" href="#规则语法" aria-label="Permalink to &quot;规则语法&quot;">​</a></h2><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern frameScript://value [filters...]</span></span></code></pre></div><table tabindex="0"><thead><tr><th>参数</th><th>描述</th><th>详细文档</th></tr></thead><tbody><tr><td>pattern</td><td>匹配请求 URL 的表达式</td><td><a href="./pattern.html">匹配模式文档</a></td></tr><tr><td>value</td><td>生成规则的 JS 脚本，支持以下类型：<br>• 目录/文件路径<br>• 远程 URL<br>• 内联/内嵌/Values内容</td><td><a href="./operation.html">操作指令文档</a></td></tr><tr><td>filters</td><td>可选过滤器，支持匹配：<br>• 请求URL/方法/头部/内容<br>• 响应状态码/头部</td><td><a href="./filters.html">过滤器文档</a></td></tr></tbody></table><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h2><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\`\`\` test-frame.js</span></span>
<span class="line"><span>// 发送预设数据</span></span>
<span class="line"><span>ctx.sendToServer(&#39;1 = 0x12300000&#39;);</span></span>
<span class="line"><span>ctx.sendToClient(&#39;1 = 0x1236666666&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 处理发往服务端的数据帧</span></span>
<span class="line"><span>ctx.handleSendToServerFrame = function(buf, opts) {</span></span>
<span class="line"><span>  // 可以返回空、null、undefined 等</span></span>
<span class="line"><span>  return (buf + &#39;&#39;).replace(/1/g, &#39;***&#39;);</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 处理发往客户端的数据帧  </span></span>
<span class="line"><span>ctx.handleSendToClientFrame = function(buf, opts) {</span></span>
<span class="line"><span>  // 可以返回空、null、undefined 等</span></span>
<span class="line"><span>  return (buf + &#39;&#39;).replace(/1/g, &#39;+++&#39;);</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>wss://echo.websocket.org/ frameScript://{test-frame.js}</span></span></code></pre></div><p>访问 <code>https://echo.websocket.org/.ws</code> 效果：</p><img width="1200" alt="frame-script" src="`+a+'"><h4 id="可用全局变量" tabindex="-1">可用全局变量 <a class="header-anchor" href="#可用全局变量" aria-label="Permalink to &quot;可用全局变量&quot;">​</a></h4><table tabindex="0"><thead><tr><th>变量/方法</th><th>描述</th></tr></thead><tbody><tr><td><code>url</code></td><td>完整请求URL</td></tr><tr><td><code>method</code></td><td>请求方法(GET/POST等)</td></tr><tr><td><code>ip</code>/<code>clientIp</code></td><td>客户端IP地址</td></tr><tr><td><code>headers</code></td><td>请求头对象</td></tr><tr><td><code>rules</code></td><td>规则数组，通过push添加新规则</td></tr><tr><td><code>values</code></td><td>临时值存储对象</td></tr><tr><td><code>render(tpl,data)</code></td><td>微型模板渲染函数</td></tr><tr><td><code>getValue(key)</code></td><td>获取Values中的值</td></tr><tr><td><code>parseUrl</code></td><td>同Node.js的<code>url.parse</code></td></tr><tr><td><code>parseQuery</code></td><td>同Node.js的<code>querystring.parse</code></td></tr><tr><td><code>sendToClient(frame, options)</code></td><td>发送数据（对象、字符串、Buffer）到客户端，用法见下面示例</td></tr><tr><td><code>sendToServer(frame, options)</code></td><td>发送数据（对象、字符串、Buffer）到服务端，用法见下面示例</td></tr><tr><td><code>handleSendToClientFrame(buffer, options)</code></td><td>处理（过滤或删除）发送到客户端的数据，用法见下面示例</td></tr><tr><td><code>handleSendToServerFrame(buffer, options)</code></td><td>处理（过滤或删除）发送到服务端的数据，用法见下面示例</td></tr></tbody></table>',11)]))}const b=e(r,[["render",p]]);export{m as __pageData,b as default};
