import{_ as e,c as s,o as t,ag as n}from"./chunks/framework.Bw-5EFTY.js";const u=JSON.parse('{"title":"replaceStatus","description":"","frontmatter":{},"headers":[],"relativePath":"docs/rules/replaceStatus.md","filePath":"docs/rules/replaceStatus.md"}'),l={name:"docs/rules/replaceStatus.md"};function i(p,a,o,r,c,d){return t(),s("div",null,a[0]||(a[0]=[n(`<h1 id="replacestatus" tabindex="-1">replaceStatus <a class="header-anchor" href="#replacestatus" aria-label="Permalink to &quot;replaceStatus&quot;">​</a></h1><p><code>replaceStatus</code> 协议用于替换 HTTP 状态码，在请求响应完成后将原始状态码替换成指定的 HTTP 状态码。通过 <code>replaceStatus</code> 协议，你可以：</p><ul><li><strong>修改服务器响应的状态码</strong>：基于真实服务器响应进行状态码替换</li><li><strong>测试不同状态码的处理逻辑</strong>：在不修改后端代码的情况下测试各种状态码场景</li><li><strong>错误场景模拟</strong>：将正常响应转换为错误状态码，测试客户端容错能力</li><li><strong>重定向测试</strong>：修改重定向状态码或目标</li></ul><h2 id="规则语法" tabindex="-1">规则语法 <a class="header-anchor" href="#规则语法" aria-label="Permalink to &quot;规则语法&quot;">​</a></h2><p><code>replaceStatus</code> 协议支持多种方式配置：</p><h3 id="_1-内联值-直接指定" tabindex="-1">1. 内联值（直接指定） <a class="header-anchor" href="#_1-内联值-直接指定" aria-label="Permalink to &quot;1. 内联值（直接指定）&quot;">​</a></h3><p>直接在规则中写明要替换的状态码。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern replaceStatus://code [lineProps...] [filters...]</span></span></code></pre></div><p><strong>示例：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/api/old replaceStatus://301</span></span></code></pre></div><h3 id="_2-内嵌值-使用代码块" tabindex="-1">2. 内嵌值（使用代码块） <a class="header-anchor" href="#_2-内嵌值-使用代码块" aria-label="Permalink to &quot;2. 内嵌值（使用代码块）&quot;">​</a></h3><p>当需要根据条件返回不同状态码，或希望复用配置时可使用此方式。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern replaceStatus://{custom-key} [lineProps...] [filters...]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` custom-key</span></span>
<span class="line"><span>404</span></span>
<span class="line"><span>\`\`\`</span></span></code></pre></div><h3 id="_3-引用-values-中的值" tabindex="-1">3. 引用 Values 中的值 <a class="header-anchor" href="#_3-引用-values-中的值" aria-label="Permalink to &quot;3. 引用 Values 中的值&quot;">​</a></h3><p>引用在界面 <code>Values</code>（中央配置区）中预先定义好的状态码。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern replaceStatus://{key-of-values} [lineProps...] [filters...]</span></span></code></pre></div><p><strong>前提</strong>：在 <code>Values</code> 中存在名为 <code>key-of-values</code> 的键，其值为状态码。</p><h3 id="_4-文件-远程-url-加载" tabindex="-1">4. 文件/远程 URL 加载 <a class="header-anchor" href="#_4-文件-远程-url-加载" aria-label="Permalink to &quot;4. 文件/远程 URL 加载&quot;">​</a></h3><p><strong>当前不支持</strong> 从本地文件或远程 URL 动态加载内容。</p><h2 id="参数详解" tabindex="-1">参数详解 <a class="header-anchor" href="#参数详解" aria-label="Permalink to &quot;参数详解&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">是否必填</th><th style="text-align:left;">描述与示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>pattern</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">用于匹配请求 URL 的表达式。<br>• 支持域名、路径、通配符、正则表达式。<br>• 详见 <a href="./pattern.html">匹配模式文档</a>。</td></tr><tr><td style="text-align:left;"><strong>code</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">要替换的 HTTP 响应状态码，如：<br>• <code>200</code> OK<br>• <code>301</code> 永久重定向<br>• <code>302</code> 临时重定向<br>• <code>404</code> 未找到<br>• <code>500</code> 服务器错误<br>• 支持所有标准 HTTP 状态码</td></tr><tr><td style="text-align:left;"><strong>lineProps</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">为规则设置附加属性。<br>• 例如：<code>lineProps://important</code> 可提升此规则的优先级。<br>• 详见 <a href="./lineProps.html">lineProps 文档</a>。</td></tr><tr><td style="text-align:left;"><strong>filters</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">可选的过滤条件，用于精确控制规则生效的场景。<br>• 可匹配请求的 URL、方法、头部、体内容。<br>• 可匹配响应的状态码、头部。<br>• 详见 <a href="./filters.html">过滤器文档</a>。</td></tr></tbody></table><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h2><h3 id="基础示例" tabindex="-1">基础示例 <a class="header-anchor" href="#基础示例" aria-label="Permalink to &quot;基础示例&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 将任何响应替换为 404 状态码</span></span>
<span class="line"><span>www.example.com replaceStatus://404</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 将服务器错误替换为正常状态码</span></span>
<span class="line"><span>www.example.com/api replaceStatus://200 includeFilter://s:500</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 修改重定向状态码</span></span>
<span class="line"><span>www.example.com/redirect replaceStatus://307</span></span></code></pre></div><h3 id="模拟认证失败" tabindex="-1">模拟认证失败 <a class="header-anchor" href="#模拟认证失败" aria-label="Permalink to &quot;模拟认证失败&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 将正常响应替换为 401 状态码，触发浏览器认证弹窗</span></span>
<span class="line"><span>www.example.com/secure-page replaceStatus://401</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 禁止弹出登录框，直接返回 401</span></span>
<span class="line"><span>www.example.com/secure-page replaceStatus://401 disable://userLogin</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 或使用 lineProps 达到同样效果</span></span>
<span class="line"><span>www.example.com/secure-page replaceStatus://401 lineProps://disableUserLogin</span></span></code></pre></div><h3 id="条件替换" tabindex="-1">条件替换 <a class="header-anchor" href="#条件替换" aria-label="Permalink to &quot;条件替换&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 仅当原始状态码为 200 时替换为 500</span></span>
<span class="line"><span>www.example.com/api replaceStatus://500 includeFilter://s:200</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 仅替换特定路径的响应状态码</span></span>
<span class="line"><span>www.example.com/api/admin replaceStatus://403</span></span></code></pre></div><h3 id="配合其他协议使用" tabindex="-1">配合其他协议使用 <a class="header-anchor" href="#配合其他协议使用" aria-label="Permalink to &quot;配合其他协议使用&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 替换状态码并修改响应内容</span></span>
<span class="line"><span>www.example.com/api/error replaceStatus://500 resBody://{errMsg}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` errMsg</span></span>
<span class="line"><span>{&quot;message&quot;:&quot;Custom error message&quot;}</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 替换为 301 重定向并设置新的 Location 头</span></span>
<span class="line"><span>www.example.com/old-url replaceStatus://301 resHeaders://location=https://www.example.com/new-url</span></span></code></pre></div><h3 id="使用内嵌值" tabindex="-1">使用内嵌值 <a class="header-anchor" href="#使用内嵌值" aria-label="Permalink to &quot;使用内嵌值&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\`\`\` maintenance-status</span></span>
<span class="line"><span>503</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 将网站所有响应替换为维护状态</span></span>
<span class="line"><span>www.example.com replaceStatus://{maintenance-status}</span></span></code></pre></div><h3 id="环境特定配置" tabindex="-1">环境特定配置 <a class="header-anchor" href="#环境特定配置" aria-label="Permalink to &quot;环境特定配置&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 仅在测试环境模拟错误</span></span>
<span class="line"><span>test.example.com/api replaceStatus://500</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 开发环境保持原样</span></span>
<span class="line"><span># dev.example.com/api (不设置 replaceStatus)</span></span></code></pre></div><h2 id="常见使用场景" tabindex="-1">常见使用场景 <a class="header-anchor" href="#常见使用场景" aria-label="Permalink to &quot;常见使用场景&quot;">​</a></h2><h3 id="_1-错误处理测试" tabindex="-1">1. 错误处理测试 <a class="header-anchor" href="#_1-错误处理测试" aria-label="Permalink to &quot;1. 错误处理测试&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 测试客户端对服务器错误的处理</span></span>
<span class="line"><span>www.example.com/api replaceStatus://500 includeFilter://chance:0.1</span></span></code></pre></div><h3 id="_2-重定向行为测试" tabindex="-1">2. 重定向行为测试 <a class="header-anchor" href="#_2-重定向行为测试" aria-label="Permalink to &quot;2. 重定向行为测试&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 测试永久重定向缓存</span></span>
<span class="line"><span>www.example.com/old-page replaceStatus://301</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 测试临时重定向</span></span>
<span class="line"><span>www.example.com/temp-redirect replaceStatus://302</span></span></code></pre></div><h3 id="_3-认证授权测试" tabindex="-1">3. 认证授权测试 <a class="header-anchor" href="#_3-认证授权测试" aria-label="Permalink to &quot;3. 认证授权测试&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 测试未认证访问</span></span>
<span class="line"><span>www.example.com/protected replaceStatus://401</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 测试权限不足</span></span>
<span class="line"><span>www.example.com/admin replaceStatus://403</span></span></code></pre></div><h3 id="_4-限流测试" tabindex="-1">4. 限流测试 <a class="header-anchor" href="#_4-限流测试" aria-label="Permalink to &quot;4. 限流测试&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 测试请求过多场景</span></span>
<span class="line"><span>www.example.com/api/rate-limited replaceStatus://429 resHeaders://retry-after=60</span></span></code></pre></div><h3 id="_5-维护模式测试" tabindex="-1">5. 维护模式测试 <a class="header-anchor" href="#_5-维护模式测试" aria-label="Permalink to &quot;5. 维护模式测试&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 测试维护页面</span></span>
<span class="line"><span>www.example.com replaceStatus://503 resBody://(&lt;h1&gt;系统维护中...&lt;/h1&gt;)</span></span></code></pre></div><h2 id="与-statuscode-的区别" tabindex="-1">与 statusCode 的区别 <a class="header-anchor" href="#与-statuscode-的区别" aria-label="Permalink to &quot;与 statusCode 的区别&quot;">​</a></h2><p><code>replaceStatus</code> 协议与 <a href="./statusCode.html"><code>statusCode</code></a> 协议的主要区别在于处理时机：</p><ul><li><strong><code>replaceStatus</code></strong>：<strong>先请求后端服务器</strong>，收到响应后替换状态码</li><li><strong><code>statusCode</code></strong>：<strong>不请求后端服务器</strong>，立即返回指定的状态码</li></ul><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h2><h3 id="_1-与-statuscode-的区别" tabindex="-1">1. 与 statusCode 的区别 <a class="header-anchor" href="#_1-与-statuscode-的区别" aria-label="Permalink to &quot;1. 与 statusCode 的区别&quot;">​</a></h3><ul><li><strong>处理时机</strong>：<code>replaceStatus</code> 在响应阶段生效，<code>statusCode</code> 在请求阶段生效</li><li><strong>服务器访问</strong>：<code>replaceStatus</code> 会访问服务器，<code>statusCode</code> 不会</li><li><strong>使用场景</strong>：需要真实服务器数据时用 <code>replaceStatus</code>，完全模拟时用 <code>statusCode</code></li></ul><h3 id="_2-响应内容保留" tabindex="-1">2. 响应内容保留 <a class="header-anchor" href="#_2-响应内容保留" aria-label="Permalink to &quot;2. 响应内容保留&quot;">​</a></h3><ul><li>默认情况下，替换状态码时响应内容保持不变</li><li>可通过配合 <a href="./resBody.html"><code>resBody</code></a> 协议修改响应内容</li></ul><h3 id="_3-认证弹窗控制" tabindex="-1">3. 认证弹窗控制 <a class="header-anchor" href="#_3-认证弹窗控制" aria-label="Permalink to &quot;3. 认证弹窗控制&quot;">​</a></h3><ul><li>替换为 <code>401</code> 状态码时，默认会触发浏览器认证弹窗</li><li>可通过以下方式禁用弹窗： <ul><li>添加 <code>disable://userLogin</code></li><li>添加 <code>lineProps://disableUserLogin</code></li><li>使用 <a href="./enable.html"><code>enable</code></a> 协议的反向配置</li></ul></li></ul><h3 id="_4-重定向处理" tabindex="-1">4. 重定向处理 <a class="header-anchor" href="#_4-重定向处理" aria-label="Permalink to &quot;4. 重定向处理&quot;">​</a></h3><ul><li>替换为重定向状态码（301、302 等）时，通常需要配合修改 <code>Location</code> 响应头</li><li>否则客户端可能无法正确处理重定向</li></ul><h3 id="_5-状态码兼容性" tabindex="-1">5. 状态码兼容性 <a class="header-anchor" href="#_5-状态码兼容性" aria-label="Permalink to &quot;5. 状态码兼容性&quot;">​</a></h3><ul><li>确保替换的状态码与响应内容兼容</li><li>例如：不应将 HTML 页面替换为 204（无内容）状态码</li></ul><h2 id="高级用法" tabindex="-1">高级用法 <a class="header-anchor" href="#高级用法" aria-label="Permalink to &quot;高级用法&quot;">​</a></h2><h3 id="状态码转换映射" tabindex="-1">状态码转换映射 <a class="header-anchor" href="#状态码转换映射" aria-label="Permalink to &quot;状态码转换映射&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 将所有重定向统一为 302</span></span>
<span class="line"><span>www.example.com replaceStatus://302 includeFilter://s:301</span></span></code></pre></div><h3 id="概率性替换" tabindex="-1">概率性替换 <a class="header-anchor" href="#概率性替换" aria-label="Permalink to &quot;概率性替换&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 10% 的概率将响应替换为错误</span></span>
<span class="line"><span>www.example.com/api replaceStatus://500 inclideFilter://chance:0.1</span></span></code></pre></div><h3 id="组合多个规则" tabindex="-1">组合多个规则 <a class="header-anchor" href="#组合多个规则" aria-label="Permalink to &quot;组合多个规则&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 针对不同原始状态码进行不同替换</span></span>
<span class="line"><span>www.example.com/api replaceStatus://200 includeFilter://s:404</span></span>
<span class="line"><span>www.example.com/api replaceStatus://400 includeFilter://s:403</span></span></code></pre></div><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to &quot;故障排除&quot;">​</a></h2><h3 id="q-状态码替换没有生效" tabindex="-1">Q: 状态码替换没有生效 <a class="header-anchor" href="#q-状态码替换没有生效" aria-label="Permalink to &quot;Q: 状态码替换没有生效&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>规则 pattern 是否正确匹配请求 URL</li><li>是否有其他更高优先级的规则覆盖</li><li>过滤器条件是否满足（特别是对原始状态码的过滤）</li></ol><h3 id="q-响应内容与状态码不匹配" tabindex="-1">Q: 响应内容与状态码不匹配 <a class="header-anchor" href="#q-响应内容与状态码不匹配" aria-label="Permalink to &quot;Q: 响应内容与状态码不匹配&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>是否同时修改了响应内容</li><li>响应头是否与新状态码兼容</li><li>客户端是否能正确处理该状态码</li></ol><h3 id="q-浏览器弹出认证窗口" tabindex="-1">Q: 浏览器弹出认证窗口 <a class="header-anchor" href="#q-浏览器弹出认证窗口" aria-label="Permalink to &quot;Q: 浏览器弹出认证窗口&quot;">​</a></h3><p><strong>A:</strong> 对于 401 状态码：</p><ol><li>检查是否添加了 <code>disable://userLogin</code> 或 <code>lineProps://disableUserLogin</code></li><li>确认规则顺序是否正确</li></ol><h3 id="q-重定向循环" tabindex="-1">Q: 重定向循环 <a class="header-anchor" href="#q-重定向循环" aria-label="Permalink to &quot;Q: 重定向循环&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>是否设置了正确的 <code>Location</code> 头</li><li>重定向目标是否正确</li><li>是否有多个重定向规则冲突</li></ol><h2 id="关联协议" tabindex="-1">关联协议 <a class="header-anchor" href="#关联协议" aria-label="Permalink to &quot;关联协议&quot;">​</a></h2><ol><li><p><strong>直接返回状态码</strong>：<a href="./statusCode.html">statusCode</a></p><ul><li>不请求服务器，直接返回指定的状态码</li></ul></li><li><p><strong>禁止认证弹窗</strong>：<a href="./disable.html">disable</a> 或 <a href="./lineProps.html">lineProps</a></p><ul><li>禁用 401 状态码触发的浏览器登录弹窗</li></ul></li><li><p><strong>设置响应内容</strong>：<a href="./resBody.html">resBody</a></p><ul><li>为状态码响应添加自定义内容</li></ul></li><li><p><strong>设置响应头</strong>：<a href="./resHeaders.html">resHeaders</a></p><ul><li>为重定向等场景设置必要的响应头</li></ul></li></ol><h2 id="扩展阅读" tabindex="-1">扩展阅读 <a class="header-anchor" href="#扩展阅读" aria-label="Permalink to &quot;扩展阅读&quot;">​</a></h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status" target="_blank" rel="noreferrer">HTTP 状态码 MDN 文档</a>：了解所有 HTTP 状态码的含义</li><li><a href="./pattern.html">匹配模式文档</a>：详细了解 URL 匹配规则</li><li><a href="./filters.html">过滤器文档</a>：了解更多过滤器功能</li></ul>`,83)]))}const b=e(l,[["render",i]]);export{u as __pageData,b as default};
