import{_ as s,c as e,o as n,ag as t}from"./chunks/framework.Bw-5EFTY.js";const g=JSON.parse('{"title":"cache","description":"","frontmatter":{},"headers":[],"relativePath":"docs/rules/cache.md","filePath":"docs/rules/cache.md"}'),i={name:"docs/rules/cache.md"};function l(p,a,c,o,h,r){return n(),e("div",null,a[0]||(a[0]=[t(`<h1 id="cache" tabindex="-1">cache <a class="header-anchor" href="#cache" aria-label="Permalink to &quot;cache&quot;">​</a></h1><p><code>cache</code> 协议用于快速设置响应的缓存控制头，帮助控制浏览器和服务器的缓存行为。可以为匹配的响应设置缓存策略，包括：</p><ul><li>设置固定的缓存时间</li><li>禁用缓存（<code>no-cache</code>）</li><li>完全禁止存储（<code>no-store</code>）</li></ul><p>这可以帮助优化网站性能或确保特定资源不会被缓存。</p><h2 id="规则语法" tabindex="-1">规则语法 <a class="header-anchor" href="#规则语法" aria-label="Permalink to &quot;规则语法&quot;">​</a></h2><p><code>cache</code> 支持多种方式设置缓存策略：</p><h3 id="_1-内联值-直接指定" tabindex="-1">1. 内联值（直接指定） <a class="header-anchor" href="#_1-内联值-直接指定" aria-label="Permalink to &quot;1. 内联值（直接指定）&quot;">​</a></h3><p>直接在规则中指定缓存策略。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 设置缓存5秒，支持正整数、0、负整数</span></span>
<span class="line"><span>pattern cache://5 [lineProps...] [filters...]</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 设置缓存头：\`cache-control: no-cache\`、\`pragma: no-cache\`</span></span>
<span class="line"><span># \`no-cache\` 可简写为 \`no\`</span></span>
<span class="line"><span>pattern cache://no-cache [lineProps...] [filters...]</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 设置缓存头：\`cache-control: no-store\`、\`pragma: no-cache\`</span></span>
<span class="line"><span>pattern cache://no-store [lineProps...] [filters...]</span></span></code></pre></div><p><strong>示例：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://example.com/api/data cache://no-cache</span></span>
<span class="line"><span>https://example.com/static/js cache://86400  # 缓存24小时</span></span></code></pre></div><h3 id="_2-内嵌值-使用代码块" tabindex="-1">2. 内嵌值（使用代码块） <a class="header-anchor" href="#_2-内嵌值-使用代码块" aria-label="Permalink to &quot;2. 内嵌值（使用代码块）&quot;">​</a></h3><p>当需要复用缓存策略或策略较复杂时可使用此方式。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern cache://{custom-key} [lineProps...] [filters...]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` custom-key</span></span>
<span class="line"><span>no-cache</span></span>
<span class="line"><span>\`\`\`</span></span></code></pre></div><h3 id="_3-引用-values-中的值" tabindex="-1">3. 引用 Values 中的值 <a class="header-anchor" href="#_3-引用-values-中的值" aria-label="Permalink to &quot;3. 引用 Values 中的值&quot;">​</a></h3><p>引用在界面 <code>Values</code> 中预先定义好的缓存策略。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern cache://{key-of-values} [lineProps...] [filters...]</span></span></code></pre></div><p><strong>前提：</strong> 在 <code>Values</code> 中存在一个名为 <code>key-of-values</code> 的键，其值为缓存策略。</p><h3 id="_4-文件-远程-url-加载" tabindex="-1">4. 文件/远程 URL 加载 <a class="header-anchor" href="#_4-文件-远程-url-加载" aria-label="Permalink to &quot;4. 文件/远程 URL 加载&quot;">​</a></h3><p><strong>当前不支持</strong> 从本地文件或远程 URL 动态加载缓存配置。</p><h2 id="参数详解" tabindex="-1">参数详解 <a class="header-anchor" href="#参数详解" aria-label="Permalink to &quot;参数详解&quot;">​</a></h2><p>| 参数 | 是否必填 | 描述与示例 | | : | : | : | | <strong>pattern</strong> | 是 | 用于匹配请求 URL 的表达式。<br>• 支持域名、路径、通配符、正则表达式。<br>• 详见 <a href="./pattern.html">匹配模式文档</a>。 | | <strong>value</strong> | 是 | 缓存策略值：<br>• <strong>数字</strong>：缓存秒数（如 <code>60</code> 表示缓存60秒）<br>• <strong>no-cache</strong> 或 <strong>no</strong>：允许缓存但每次需重新验证<br>• <strong>no-store</strong>：完全禁止缓存<br>• 支持内联、内嵌、Values 引用<br>• ⚠️ 不支持从文件或远程 URL 加载 | | <strong>lineProps</strong> | 否 | 为规则设置附加属性。<br>• 例如：<code>lineProps://important</code> 可提升此规则的优先级。<br>• 详见 <a href="./lineProps.html">lineProps 文档</a>。 | | <strong>filters</strong> | 否 | 可选的过滤条件，用于精确控制规则生效的场景。<br>• 可匹配请求的 URL、方法、头部、体内容。<br>• 可匹配响应的状态码、头部。<br>• 详见 <a href="./filters.html">过滤器文档</a>。 |</p><p><strong>影响的响应头：</strong></p><ul><li><code>Cache-Control</code></li><li><code>Expires</code></li><li><code>Pragma</code></li></ul><h2 id="缓存策略说明" tabindex="-1">缓存策略说明 <a class="header-anchor" href="#缓存策略说明" aria-label="Permalink to &quot;缓存策略说明&quot;">​</a></h2><p>| 策略 | 含义 | 典型使用场景 | | : | : | : | | <strong>数字（如 <code>60</code>）</strong> | 设置资源缓存指定秒数 | 静态资源、不经常变化的API响应 | | <strong>no-cache</strong>（或 <strong>no</strong>） | 允许缓存但每次使用前必须验证 | 经常变化的内容，如用户数据、实时报价 | | <strong>no-store</strong> | 完全禁止缓存任何版本 | 敏感数据、支付页面、一次性令牌 |</p><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h2><h3 id="基础示例" tabindex="-1">基础示例 <a class="header-anchor" href="#基础示例" aria-label="Permalink to &quot;基础示例&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 静态资源缓存1小时</span></span>
<span class="line"><span>https://example.com/static/* cache://3600</span></span>
<span class="line"><span></span></span>
<span class="line"><span># API接口禁用缓存</span></span>
<span class="line"><span>https://example.com/api/* cache://no-cache</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 敏感数据禁止缓存</span></span>
<span class="line"><span>https://example.com/account/* cache://no-store</span></span></code></pre></div><h3 id="使用内嵌值" tabindex="-1">使用内嵌值 <a class="header-anchor" href="#使用内嵌值" aria-label="Permalink to &quot;使用内嵌值&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://example.com/reports/* cache://{report-cache-policy}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` report-cache-policy</span></span>
<span class="line"><span>no-cache</span></span>
<span class="line"><span>\`\`\`</span></span></code></pre></div><h3 id="配合过滤器使用" tabindex="-1">配合过滤器使用 <a class="header-anchor" href="#配合过滤器使用" aria-label="Permalink to &quot;配合过滤器使用&quot;">​</a></h3><p>仅对特定响应状态码设置缓存：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://example.com/api/* cache://300 includeFilter://s:200</span></span></code></pre></div><h3 id="引用-values-中的配置" tabindex="-1">引用 Values 中的配置 <a class="header-anchor" href="#引用-values-中的配置" aria-label="Permalink to &quot;引用 Values 中的配置&quot;">​</a></h3><p>假设在 Values 中已有 <code>static-cache</code> 配置：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://example.com/assets/* cache://{static-cache}</span></span></code></pre></div><h2 id="工作原理与关联协议" tabindex="-1">工作原理与关联协议 <a class="header-anchor" href="#工作原理与关联协议" aria-label="Permalink to &quot;工作原理与关联协议&quot;">​</a></h2><ol><li><p><strong>核心原理</strong>：<code>cache</code> 协议自动设置相应的缓存控制头：</p><ul><li><p><code>cache://5</code> 设置：</p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Cache-Control</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max-age=5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Expires</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> [当前时间+5秒]</span></span></code></pre></div></li><li><p><code>cache://no-cache</code> 设置：</p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Cache-Control</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no-cache</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Pragma</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no-cache</span></span></code></pre></div></li><li><p><code>cache://no-store</code> 设置：</p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Cache-Control</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no-store</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Pragma</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no-cache</span></span></code></pre></div></li></ul></li><li><p><strong>关联协议</strong>：</p><ul><li><strong>禁用缓存</strong>：更彻底的缓存禁用方案，同时移除请求和响应中的缓存相关头。详见：<a href="./disable.html">disable://cache</a></li><li><strong>手动设置头部</strong>：对于更复杂的缓存控制，可以使用 <a href="./resHeaders.html"><code>resHeaders</code></a> 协议手动设置缓存头。</li></ul></li></ol><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h2><ul><li>缓存时间以秒为单位，不支持小数</li><li>设置 <code>no-cache</code> 不代表&quot;不缓存&quot;，而是&quot;使用前必须验证&quot;</li><li>对于需要完全禁用缓存的场景，建议同时使用 <a href="./disable.html"><code>disable://cache</code></a> 协议</li><li>实际缓存行为还受服务器配置和浏览器实现的影响</li></ul>`,41)]))}const u=s(i,[["render",l]]);export{g as __pageData,u as default};
