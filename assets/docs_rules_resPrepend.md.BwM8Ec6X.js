import{_ as s,c as e,o as n,ag as t}from"./chunks/framework.Bw-5EFTY.js";const u=JSON.parse('{"title":"resPrepend","description":"","frontmatter":{},"headers":[],"relativePath":"docs/rules/resPrepend.md","filePath":"docs/rules/resPrepend.md"}'),p={name:"docs/rules/resPrepend.md"};function l(i,a,o,r,d,c){return n(),e("div",null,a[0]||(a[0]=[t(`<h1 id="resprepend" tabindex="-1">resPrepend <a class="header-anchor" href="#resprepend" aria-label="Permalink to &quot;resPrepend&quot;">​</a></h1><p><code>resPrepend</code> 协议用于在现有响应内容体的开头插入指定内容，仅对包含响应内容体的状态码（如 <code>200</code>、<code>500</code> 等）有效，通过 <code>resPrepend</code> 协议，你可以：</p><ul><li>在响应内容的开头添加自定义内容</li><li>插入调试信息或时间戳</li><li>添加脚本、样式表或其他资源的引用</li><li>注入环境标记或版本信息</li><li>保持原始响应内容完整，仅在开头添加额外内容</li></ul><blockquote><p><strong>生效条件</strong>：仅对有响应内容体的状态码生效</p><p>⚠️ 注意：<code>204</code>、<code>304</code> 等无响应内容体的请求不受影响</p></blockquote><h2 id="规则语法" tabindex="-1">规则语法 <a class="header-anchor" href="#规则语法" aria-label="Permalink to &quot;规则语法&quot;">​</a></h2><p><code>resPrepend</code> 支持多种方式指定要插入的内容：</p><h3 id="_1-内联值-直接指定" tabindex="-1">1. 内联值（直接指定） <a class="header-anchor" href="#_1-内联值-直接指定" aria-label="Permalink to &quot;1. 内联值（直接指定）&quot;">​</a></h3><p>直接在规则中写明要插入的内容，适用于简短文本（不能包含空格和换行符）。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern resPrepend://(value) [lineProps...] [filters...]</span></span></code></pre></div><p><strong>示例：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/page resPrepend://(&lt;!--页面开始--&gt;)</span></span></code></pre></div><h3 id="_2-内嵌值-使用代码块" tabindex="-1">2. 内嵌值（使用代码块） <a class="header-anchor" href="#_2-内嵌值-使用代码块" aria-label="Permalink to &quot;2. 内嵌值（使用代码块）&quot;">​</a></h3><p>当需要处理包含空格、换行符的复杂内容，或希望复用某段配置时，推荐使用此方式。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern resPrepend://{custom-key} [lineProps...] [filters...]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` custom-key</span></span>
<span class="line"><span>&lt;!-- 调试信息 --&gt;</span></span>
<span class="line"><span>&lt;script&gt;</span></span>
<span class="line"><span>  console.log(&#39;页面加载时间:&#39;, new Date().toISOString());</span></span>
<span class="line"><span>&lt;/script&gt;</span></span>
<span class="line"><span>\`\`\`</span></span></code></pre></div><h3 id="_3-引用-values-中的值" tabindex="-1">3. 引用 Values 中的值 <a class="header-anchor" href="#_3-引用-values-中的值" aria-label="Permalink to &quot;3. 引用 Values 中的值&quot;">​</a></h3><p>当内容较大时，可以将其存储在 <code>Values</code> 配置区中。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern resPrepend://{key-of-values} [lineProps...] [filters...]</span></span></code></pre></div><p><strong>前提</strong>：在 <code>Values</code> 中存在名为 <code>key-of-values</code> 的键，其值为要插入的内容。</p><h3 id="_4-从文件路径或远程-url-加载" tabindex="-1">4. 从文件路径或远程 URL 加载 <a class="header-anchor" href="#_4-从文件路径或远程-url-加载" aria-label="Permalink to &quot;4. 从文件路径或远程 URL 加载&quot;">​</a></h3><p>从本地文件或远程 URL 加载要插入的响应内容。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 从本地文件加载</span></span>
<span class="line"><span>pattern resPrepend:///User/xxx/header.html</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 从远程 URL 加载</span></span>
<span class="line"><span>pattern resPrepend://https://cdn.example.com/analytics-script.js</span></span></code></pre></div><h3 id="_5-从临时文件中加载" tabindex="-1">5. 从临时文件中加载 <a class="header-anchor" href="#_5-从临时文件中加载" aria-label="Permalink to &quot;5. 从临时文件中加载&quot;">​</a></h3><p>当需要频繁编辑内容时，可以使用 Whistle 提供的临时文件功能。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern resPrepend://temp/blank.txt</span></span></code></pre></div><p><strong>操作步骤</strong>：</p><ol><li>在 Rules 编辑器中，按住 <code>Command</code>（Mac）/ <code>Ctrl</code>（Windows）</li><li>鼠标点击 <code>resPrepend://temp/blank.txt</code></li><li>在弹出的编辑对话框中输入要插入的内容</li><li>点击 <code>Save</code> 保存</li></ol><h2 id="参数详解" tabindex="-1">参数详解 <a class="header-anchor" href="#参数详解" aria-label="Permalink to &quot;参数详解&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">是否必填</th><th style="text-align:left;">描述与示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>pattern</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">用于匹配请求 URL 的表达式。<br>• 支持域名、路径、通配符、正则表达式。<br>• 详见 <a href="./pattern.html">匹配模式文档</a>。</td></tr><tr><td style="text-align:left;"><strong>value</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">要插入的响应内容，支持多种格式：<br>• 本地文件路径<br>• 远程 URL<br>• 内联、内嵌、Values 引用内容</td></tr><tr><td style="text-align:left;"><strong>lineProps</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">为规则设置附加属性。<br>• 例如：<code>lineProps://important</code> 可提升此规则的优先级。<br>• 详见 <a href="./lineProps.html">lineProps 文档</a>。</td></tr><tr><td style="text-align:left;"><strong>filters</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">可选的过滤条件，用于精确控制规则生效的场景。<br>• 可匹配请求的 URL、方法、头部、体内容。<br>• 可匹配响应的状态码、头部。<br>• 详见 <a href="./filters.html">过滤器文档</a>。</td></tr></tbody></table><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h2><h3 id="基础示例" tabindex="-1">基础示例 <a class="header-anchor" href="#基础示例" aria-label="Permalink to &quot;基础示例&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 在 HTML 页面开头添加注释</span></span>
<span class="line"><span>www.example.com/index.html resPrepend://(&lt;!--页面开始时间:--&gt;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 在 JSON 响应前添加时间戳</span></span>
<span class="line"><span>api.example.com/data.json resPrepend://({&quot;timestamp&quot;:&quot;2024-01-01T00:00:00Z&quot;})</span></span></code></pre></div><h3 id="示例场景分析" tabindex="-1">示例场景分析 <a class="header-anchor" href="#示例场景分析" aria-label="Permalink to &quot;示例场景分析&quot;">​</a></h3><h4 id="场景-1-插入调试信息" tabindex="-1">场景 1：插入调试信息 <a class="header-anchor" href="#场景-1-插入调试信息" aria-label="Permalink to &quot;场景 1：插入调试信息&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\`\`\` debug-header</span></span>
<span class="line"><span>&lt;!-- </span></span>
<span class="line"><span>  调试信息：</span></span>
<span class="line"><span>  - URL: \${url}</span></span>
<span class="line"><span>  - 时间: \${now}</span></span>
<span class="line"><span>  - 用户代理: \${reqHeaders.user-agent}</span></span>
<span class="line"><span>--&gt;</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>www.example.com resPrepend://\`{debug-header}\`</span></span></code></pre></div><h4 id="场景-2-添加页面头部内容" tabindex="-1">场景 2：添加页面头部内容 <a class="header-anchor" href="#场景-2-添加页面头部内容" aria-label="Permalink to &quot;场景 2：添加页面头部内容&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 添加公共头部</span></span>
<span class="line"><span>^www.example.com/*.html resPrepend://{custom-html}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` custom-html</span></span>
<span class="line"><span>&lt;div class=&quot;site-header&quot;&gt;网站头部&lt;/div&gt;</span></span>
<span class="line"><span>\`\`\`</span></span></code></pre></div><h4 id="场景-3-注入分析脚本" tabindex="-1">场景 3：注入分析脚本 <a class="header-anchor" href="#场景-3-注入分析脚本" aria-label="Permalink to &quot;场景 3：注入分析脚本&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 添加 Google Analytics 脚本</span></span>
<span class="line"><span>www.example.com resPrepend://{google-analytics}</span></span>
<span class="line"><span>\`\`\` google-analytics</span></span>
<span class="line"><span>&lt;script async src=&quot;https://www.googletagmanager.com/gtag/js?id=UA-XXXXX&quot;&gt;&lt;/script&gt;</span></span>
<span class="line"><span>&lt;script&gt;</span></span>
<span class="line"><span>  window.dataLayer = window.dataLayer || [];</span></span>
<span class="line"><span>  function gtag(){dataLayer.push(arguments);}</span></span>
<span class="line"><span>  gtag(&#39;js&#39;, new Date());</span></span>
<span class="line"><span>  gtag(&#39;config&#39;, &#39;UA-XXXXX&#39;);</span></span>
<span class="line"><span>&lt;/script&gt;</span></span>
<span class="line"><span>\`\`\`</span></span></code></pre></div><h3 id="配合其他协议使用" tabindex="-1">配合其他协议使用 <a class="header-anchor" href="#配合其他协议使用" aria-label="Permalink to &quot;配合其他协议使用&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 先添加头部内容，再添加尾部内容</span></span>
<span class="line"><span>www.example.com/page resPrepend://(&lt;header&gt;) resAppend://(&lt;/footer&gt;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 配合 file 协议使用</span></span>
<span class="line"><span>www.example.com/path resPrepend://(Hello) file://(-test-)</span></span></code></pre></div><p><strong>响应结果：</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Hello-test-</span></span></code></pre></div><h3 id="使用内嵌值" tabindex="-1">使用内嵌值 <a class="header-anchor" href="#使用内嵌值" aria-label="Permalink to &quot;使用内嵌值&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\`\`\` body.txt</span></span>
<span class="line"><span>Hello world.</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>www.example.com/path resPrepend://{body.txt} file://(-test-)</span></span></code></pre></div><p><strong>响应结果：</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Hello world.-test-</span></span></code></pre></div><h3 id="从文件或远程-url-加载" tabindex="-1">从文件或远程 URL 加载 <a class="header-anchor" href="#从文件或远程-url-加载" aria-label="Permalink to &quot;从文件或远程 URL 加载&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 从本地文件加载</span></span>
<span class="line"><span>www.example.com/path1 resPrepend:///User/xxx/test.txt</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 从远程 URL 加载</span></span>
<span class="line"><span>www.example.com/path2 resPrepend://https://www.xxx.com/xxx/params.txt</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 使用临时文件</span></span>
<span class="line"><span>www.example.com/path3 resPrepend://temp/blank.txt</span></span></code></pre></div><h3 id="配合过滤器使用" tabindex="-1">配合过滤器使用 <a class="header-anchor" href="#配合过滤器使用" aria-label="Permalink to &quot;配合过滤器使用&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 仅为开发环境添加调试信息</span></span>
<span class="line"><span>www.example.com resPrepend://(&lt;!--开发环境--&gt;) includeFilter://reqH:host=/dev\\./</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 仅对 HTML 页面添加头部</span></span>
<span class="line"><span>www.example.com resPrepend://{header} resType://html</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` header</span></span>
<span class="line"><span>&lt;div class=&quot;header&quot; /&gt;</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 根据响应状态码决定是否添加内容</span></span>
<span class="line"><span>www.example.com/api resPrepend://({&quot;debug&quot;:true}) includeFilter://s:200</span></span></code></pre></div><h2 id="高级用法" tabindex="-1">高级用法 <a class="header-anchor" href="#高级用法" aria-label="Permalink to &quot;高级用法&quot;">​</a></h2><h3 id="动态内容插入" tabindex="-1">动态内容插入 <a class="header-anchor" href="#动态内容插入" aria-label="Permalink to &quot;动态内容插入&quot;">​</a></h3><p>使用模板字符串实现动态内容：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 插入当前时间戳</span></span>
<span class="line"><span>www.example.com/api resPrepend://\`({&quot;timestamp&quot;:&quot;\${now}&quot;})\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 插入请求信息</span></span>
<span class="line"><span>www.example.com/debug resPrepend://\`{req-info}\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` req-info</span></span>
<span class="line"><span>&lt;!-- 请求方法: \${method}, 路径: \${path} --&gt;</span></span>
<span class="line"><span>\`\`\`</span></span></code></pre></div><h3 id="组合多个插入内容" tabindex="-1">组合多个插入内容 <a class="header-anchor" href="#组合多个插入内容" aria-label="Permalink to &quot;组合多个插入内容&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 插入多个内容片段</span></span>
<span class="line"><span>www.example.com/page resPrepend://{header1} resPrepend://{header2}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` header1</span></span>
<span class="line"><span>&lt;div id=&quot;header1&quot; /&gt;</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span>\`\`\` header2</span></span>
<span class="line"><span>&lt;div id=&quot;header2&quot; /&gt;</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span># 最终结果: &lt;div id=&quot;header2&quot; /&gt;&lt;div id=&quot;header1&quot; /&gt;[原始内容]</span></span></code></pre></div><h3 id="条件插入" tabindex="-1">条件插入 <a class="header-anchor" href="#条件插入" aria-label="Permalink to &quot;条件插入&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 仅在特定条件下插入内容</span></span>
<span class="line"><span>www.example.com/admin resPrepend://{log.js} includeFilter://reqH:cookie=/admin=true/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\`\` log.js</span></span>
<span class="line"><span>&lt;script&gt;console.log(&#39;管理员页面&#39;)&lt;/script&gt;</span></span>
<span class="line"><span>\`\`\`\`</span></span></code></pre></div><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><h3 id="q-resprepend-规则没有生效" tabindex="-1">Q: resPrepend 规则没有生效 <a class="header-anchor" href="#q-resprepend-规则没有生效" aria-label="Permalink to &quot;Q: resPrepend 规则没有生效&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>响应状态码是否有响应体（排除 204、304 等）</li><li>规则 pattern 是否正确匹配请求 URL</li><li>过滤器条件是否满足</li><li>是否有其他规则干扰</li></ol><h3 id="q-如何确保插入内容在特定位置" tabindex="-1">Q: 如何确保插入内容在特定位置 <a class="header-anchor" href="#q-如何确保插入内容在特定位置" aria-label="Permalink to &quot;Q: 如何确保插入内容在特定位置&quot;">​</a></h3><p><strong>A:</strong></p><ul><li><code>resPrepend</code> 始终在响应内容的最前面插入</li><li>如果需要在其他位置插入，请考虑使用 <code>resReplace</code> 配合正则表达式替换</li></ul><h3 id="q-能否删除原始响应的部分内容" tabindex="-1">Q: 能否删除原始响应的部分内容 <a class="header-anchor" href="#q-能否删除原始响应的部分内容" aria-label="Permalink to &quot;Q: 能否删除原始响应的部分内容&quot;">​</a></h3><p><strong>A:</strong> 不能。<code>resPrepend</code> 只负责添加内容，不删除或修改原始内容。如需删除内容，请使用 <code>resBody</code> 协议。</p><h2 id="与-resbody-的区别" tabindex="-1">与 resBody 的区别 <a class="header-anchor" href="#与-resbody-的区别" aria-label="Permalink to &quot;与 resBody 的区别&quot;">​</a></h2><p><code>resPrepend</code> 协议与 <a href="./resBody.html"><code>resBody</code></a> 协议的主要区别在于处理方式：</p><ul><li><strong><code>resPrepend</code></strong>：在原始响应内容<strong>前面</strong>插入指定内容，保留原始内容</li><li><strong><code>resBody</code></strong>：<strong>替换</strong>整个响应内容，不保留原始内容</li></ul><h2 id="关联协议" tabindex="-1">关联协议 <a class="header-anchor" href="#关联协议" aria-label="Permalink to &quot;关联协议&quot;">​</a></h2><ol><li><p><strong>替换响应内容</strong>：<a href="./resBody.html">resBody</a></p><ul><li>完全替换响应内容，不保留原始内容</li></ul></li><li><p><strong>在响应内容后面追加内容</strong>：<a href="./resAppend.html">resAppend</a></p><ul><li>在响应内容的末尾添加内容</li></ul></li><li><p><strong>替换请求内容</strong>：<a href="./reqBody.html">reqBody</a></p><ul><li>替换发送到服务器的请求体内容</li></ul></li><li><p><strong>在请求内容前面插入内容</strong>：<a href="./reqPrepend.html">reqPrepend</a></p><ul><li>在请求体内容的前面插入内容</li></ul></li><li><p><strong>在请求内容后面追加内容</strong>：<a href="./reqAppend.html">reqAppend</a></p><ul><li>在请求体内容的末尾添加内容</li></ul></li></ol><h2 id="扩展阅读" tabindex="-1">扩展阅读 <a class="header-anchor" href="#扩展阅读" aria-label="Permalink to &quot;扩展阅读&quot;">​</a></h2><ul><li><a href="./pattern.html">匹配模式文档</a>：详细了解 URL 匹配规则</li><li><a href="./operation.html">操作指令文档</a>：了解内容加载的多种方式</li><li><a href="./filters.html">过滤器文档</a>：了解更多过滤器功能</li></ul>`,74)]))}const g=s(p,[["render",l]]);export{u as __pageData,g as default};
