import{_ as a,c as i,o as t,ag as n}from"./chunks/framework.Bw-5EFTY.js";const c=JSON.parse('{"title":"tlsOptions","description":"","frontmatter":{},"headers":[],"relativePath":"docs/rules/cipher.md","filePath":"docs/rules/cipher.md"}'),e={name:"docs/rules/cipher.md"};function l(p,s,h,o,r,k){return t(),i("div",null,s[0]||(s[0]=[n(`<h1 id="tlsoptions" tabindex="-1">tlsOptions <a class="header-anchor" href="#tlsoptions" aria-label="Permalink to &quot;tlsOptions&quot;">​</a></h1><p><code>tlsOptions</code> 协议用于配置 HTTPS/TLS 连接的安全参数，包括加密算法套件、客户端证书等，用于建立加密通信通道和服务器身份验证。</p><blockquote><p><strong>版本要求</strong>：仅 Whistle 最新版本（≥ v2.9.101）支持此功能</p></blockquote><p>通过 <code>tlsOptions</code> 协议，你可以：</p><ul><li>自定义 TLS 加密算法套件</li><li>配置双向认证（mTLS）所需的客户端证书</li><li>设置 TLS 连接的其他安全参数</li><li>控制 TLS 版本和连接选项</li></ul><p><strong>规则合并机制</strong>：<code>tlsOptions</code> 支持设置任意多个配置规则，Whistle 会根据从上到下的顺序自动合并这些规则，允许你灵活组合不同的 TLS 配置。</p><h2 id="规则语法" tabindex="-1">规则语法 <a class="header-anchor" href="#规则语法" aria-label="Permalink to &quot;规则语法&quot;">​</a></h2><p><code>tlsOptions</code> 支持多种方式配置 HTTPS/TLS 连接的安全参数：</p><h3 id="_1-内联值-直接指定" tabindex="-1">1. 内联值（直接指定） <a class="header-anchor" href="#_1-内联值-直接指定" aria-label="Permalink to &quot;1. 内联值（直接指定）&quot;">​</a></h3><p>直接在规则中写明操作。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 设置客户端证书</span></span>
<span class="line"><span>pattern tlsOptions://key=/path/to/client.key&amp;cert=/path/to/client.crt</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 自定义加密套件</span></span>
<span class="line"><span>pattern tlsOptions://ECDHE-ECDSA-AES256-GCM-SHA384:DH-RSA-AES256-GCM-SHA384 [lineProps...] [filters...]</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 或使用 ciphers 参数</span></span>
<span class="line"><span>pattern tlsOptions://ciphers=ECDHE-ECDSA-AES256-GCM-SHA384:DH-RSA-AES256-GCM-SHA384 [lineProps...] [filters...]</span></span></code></pre></div><h3 id="_2-内嵌值-使用代码块" tabindex="-1">2. 内嵌值（使用代码块） <a class="header-anchor" href="#_2-内嵌值-使用代码块" aria-label="Permalink to &quot;2. 内嵌值（使用代码块）&quot;">​</a></h3><p>当配置较复杂或需要复用时可使用此方式。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern tlsOptions://{custom-key} [lineProps...] [filters...]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` custom-key</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  passphrase: &quot;123456&quot;,</span></span>
<span class="line"><span>  pfx: &quot;-----BEGIN PKCS7-----\\n...&quot;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>\`\`\`</span></span></code></pre></div><h3 id="_3-引用-values-中的值" tabindex="-1">3. 引用 Values 中的值 <a class="header-anchor" href="#_3-引用-values-中的值" aria-label="Permalink to &quot;3. 引用 Values 中的值&quot;">​</a></h3><p>引用在界面 <code>Values</code>（中央配置区）中预先定义好的配置。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern tlsOptions://{key-of-values} [lineProps...] [filters...]</span></span></code></pre></div><p><strong>前提：</strong> 在 <code>Values</code> 中存在一个名为 <code>key-of-values</code> 的键，其值为 TLS 配置对象。</p><h3 id="_4-从临时文件中加载" tabindex="-1">4. 从临时文件中加载 <a class="header-anchor" href="#_4-从临时文件中加载" aria-label="Permalink to &quot;4. 从临时文件中加载&quot;">​</a></h3><p>当需要频繁编辑内容时，可以使用 Whistle 提供的临时文件功能。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern tlsOptions://temp.json</span></span></code></pre></div><p><strong>操作步骤</strong>：</p><ol><li>在 Rules 编辑器中，按住 <code>Command</code>（Mac）/ <code>Ctrl</code>（Windows）</li><li>鼠标点击 <code>tlsOptions://temp.json</code></li><li>在弹出的编辑对话框中输入响应内容</li><li>点击 <code>Save</code> 保存</li></ol><p>保存后规则会自动变为类似以下格式：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://example.com/report tlsOptions://temp/11adb9c9e1142df67b30d7646ec59bcd34c855d9011d1a2405c7fc2dfc94568d.json</span></span></code></pre></div><p>需要再次编辑时，用同样的方式点击该临时文件链接即可。</p><h3 id="_5-从文件或远程-url-加载" tabindex="-1">5. 从文件或远程 URL 加载 <a class="header-anchor" href="#_5-从文件或远程-url-加载" aria-label="Permalink to &quot;5. 从文件或远程 URL 加载&quot;">​</a></h3><p>从本地文件或远程 URL 加载包含 TLS 配置的 JSON 或 YAML 文件。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 从本地文件加载</span></span>
<span class="line"><span>pattern tlsOptions:///User/xxx/tlsOptions.json</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 从远程 URL 加载（支持 http 和 https）</span></span>
<span class="line"><span>pattern tlsOptions://https://config.example.com/tlsOptions.json</span></span></code></pre></div><p><strong>文件格式要求：</strong> 文件内容应为 JSON 或 YAML 格式：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;ciphers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;minVersion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TLSv1.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;maxVersion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TLSv1.3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;secureProtocol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TLSv1_2_method&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>或</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ciphers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">minVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TLSv1.2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">maxVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TLSv1.3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">secureProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TLSv1_2_method</span></span></code></pre></div><hr><h2 id="参数详解" tabindex="-1">参数详解 <a class="header-anchor" href="#参数详解" aria-label="Permalink to &quot;参数详解&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">是否必填</th><th style="text-align:left;">描述与示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>pattern</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">用于匹配请求 URL 的表达式。<br>• 支持域名、路径、通配符、正则表达式。<br>• 详见 <a href="./pattern.html">匹配模式文档</a>。</td></tr><tr><td style="text-align:left;"><strong>value</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">TLS 配置数据，支持多种格式：<br>• 加密算法套件名称（用 <code>:</code> 分隔）<br>• <code>tls.connect(options)</code> 参数对象<br>• 支持从本地文件、远程 URL、内联、内嵌、Values 引用</td></tr><tr><td style="text-align:left;"><strong>lineProps</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">为规则设置附加属性。<br>• 例如：<code>lineProps://important</code> 可提升此规则的优先级。<br>• 详见 <a href="./lineProps.html">lineProps 文档</a>。</td></tr><tr><td style="text-align:left;"><strong>filters</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">可选的过滤条件，用于精确控制规则生效的场景。<br>• 可匹配请求的 URL、方法、头部、体内容。<br>• 可匹配响应的状态码、头部。<br>• 详见 <a href="./filters.html">过滤器文档</a>。</td></tr></tbody></table><hr><h2 id="配置对象参考" tabindex="-1">配置对象参考 <a class="header-anchor" href="#配置对象参考" aria-label="Permalink to &quot;配置对象参考&quot;">​</a></h2><p>完整的 TLS 连接配置对象，支持 Node.js <a href="https://nodejs.org/docs/latest/api/tls.html#tlscreatesecurecontextoptions" target="_blank" rel="noreferrer"><code>tls.connect()</code></a> 的所有参数：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 加密算法套件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ciphers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // TLS 协议版本控制</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  minVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TLSv1.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  maxVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TLSv1.3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  secureProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TLSv1_2_method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 证书相关配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ca</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-----BEGIN CERTIFICATE-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// CA 证书</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-----BEGIN CERTIFICATE-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 客户端证书</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-----BEGIN PRIVATE KEY-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 私钥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  pfx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-----BEGIN PKCS7-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// PFX/P12 格式证书</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  passphrase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cert-password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 证书密码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 其他安全选项</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  honorCipherOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 优先使用服务器端的加密套件顺序</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  requestCert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求客户端证书（双向认证）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  rejectUnauthorized</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 拒绝未授权的证书</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 高级选项</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ecdhCurve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ECDH 曲线</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dhparam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-----BEGIN DH PARAMETERS-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  secureOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// SSL 选项标志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  sessionTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 会话超时时间（秒）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  sessionIdContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;whistle&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h2><h3 id="_1-自定义加密套件" tabindex="-1">1. 自定义加密套件 <a class="header-anchor" href="#_1-自定义加密套件" aria-label="Permalink to &quot;1. 自定义加密套件&quot;">​</a></h3><p>限制特定域名的 TLS 加密算法：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/path tlsOptions://ECDHE-ECDSA-AES256-GCM-SHA384:DH-RSA-AES256-GCM-SHA384</span></span></code></pre></div><blockquote><p><strong>使用场景</strong>：解决特定服务器的兼容性问题。参考：<a href="https://github.com/avwo/whistle/issues/963" target="_blank" rel="noreferrer">GitHub Issue #963</a></p></blockquote><h3 id="_2-配置客户端证书-双向认证-mtls" tabindex="-1">2. 配置客户端证书（双向认证 mTLS） <a class="header-anchor" href="#_2-配置客户端证书-双向认证-mtls" aria-label="Permalink to &quot;2. 配置客户端证书（双向认证 mTLS）&quot;">​</a></h3><p><strong>cert 格式证书：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.exaple.com/path tlsOptions://key=/User/xxx/test.key&amp;cert=/User/xxx/test.crt</span></span></code></pre></div><p><strong>pem 格式证书：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.exaple.com/path tlsOptions://key=E:\\test.key&amp;cert=E:\\test.pem</span></span></code></pre></div><p><strong>pfx 格式证书：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.exaple.com/path tlsOptions://passphrase=123456&amp;pfx=/User/xxx/test.pfx</span></span></code></pre></div><p><strong>p12 格式证书：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.exaple.com/path tlsOptions://passphrase=123456&amp;pfx=E:/test.p12</span></span></code></pre></div><blockquote><p><strong>Windows 路径</strong>：支持混用 <code>/</code> 和 <code>\\</code> 作为路径分隔符</p></blockquote><h3 id="_3-内嵌证书内容" tabindex="-1">3. 内嵌证书内容 <a class="header-anchor" href="#_3-内嵌证书内容" aria-label="Permalink to &quot;3. 内嵌证书内容&quot;">​</a></h3><p>直接将证书内容嵌入配置中：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\`\`\` test.json</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  key: &#39;----xxx----- ... ----xxx-----&#39;,</span></span>
<span class="line"><span>  cert: &#39;----yyy----- ... ----yyy-----&#39;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>www.exaple.com/path tlsOptions://{test.json}</span></span></code></pre></div><h3 id="_4-从本地或远程文件加载配置" tabindex="-1">4. 从本地或远程文件加载配置 <a class="header-anchor" href="#_4-从本地或远程文件加载配置" aria-label="Permalink to &quot;4. 从本地或远程文件加载配置&quot;">​</a></h3><p><strong>从本地文件加载：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/path1 tlsOptions:///User/xxx/test.json</span></span></code></pre></div><p><strong>从远程 URL 加载：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/path2 tlsOptions://https://www.xxx.com/xxx/params.json</span></span></code></pre></div><p><strong>使用临时文件编辑：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/path3 tlsOptions://temp/blank.json</span></span></code></pre></div><h3 id="_5-规则合并示例" tabindex="-1">5. 规则合并示例 <a class="header-anchor" href="#_5-规则合并示例" aria-label="Permalink to &quot;5. 规则合并示例&quot;">​</a></h3><p>利用规则合并特性，逐步细化配置：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 第一层：为整个域名设置基础TLS版本</span></span>
<span class="line"><span>*.example.com tlsOptions://minVersion=TLSv1.2</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 第二层：为API子域添加客户端证书</span></span>
<span class="line"><span>api.example.com tlsOptions://key=/certs/client.key&amp;cert=/certs/client.crt</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 第三层：为特定路径进一步限制加密套件</span></span>
<span class="line"><span>api.example.com/secure/* tlsOptions://ciphers=ECDHE-RSA-AES256-GCM-SHA384</span></span></code></pre></div><hr><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h2><ol><li><strong>版本兼容性</strong>：确保使用的 Whistle 版本 ≥ v2.9.101</li><li><strong>证书格式</strong>：不同格式的证书需要使用对应的参数： <ul><li>PEM 格式：使用 <code>key</code> 和 <code>cert</code> 参数</li><li>PFX/P12 格式：使用 <code>pfx</code> 和 <code>passphrase</code> 参数</li></ul></li><li><strong>路径处理</strong>： <ul><li>相对路径相对于 Whistle 配置文件目录</li><li>Windows 路径可以混用 <code>/</code> 和 <code>\\</code></li></ul></li><li><strong>安全警告</strong>： <ul><li>谨慎使用 <code>rejectUnauthorized: false</code>，仅限开发环境</li><li>妥善保管客户端私钥，避免泄露</li></ul></li><li><strong>性能影响</strong>：复杂的加密算法可能影响连接性能</li><li><strong>调试建议</strong>：遇到连接问题时，可先用简单的配置测试，逐步添加复杂选项</li></ol><hr><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to &quot;故障排除&quot;">​</a></h2><h3 id="q-证书加载失败" tabindex="-1">Q: 证书加载失败 <a class="header-anchor" href="#q-证书加载失败" aria-label="Permalink to &quot;Q: 证书加载失败&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>证书文件路径是否正确</li><li>证书格式是否匹配参数类型</li><li>PFX 证书密码是否正确</li></ol><h3 id="q-连接被拒绝" tabindex="-1">Q: 连接被拒绝 <a class="header-anchor" href="#q-连接被拒绝" aria-label="Permalink to &quot;Q: 连接被拒绝&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>TLS 版本是否被服务器支持</li><li>加密算法套件是否被服务器支持</li><li>客户端证书是否有效且被服务器信任</li></ol><h3 id="q-配置未生效" tabindex="-1">Q: 配置未生效 <a class="header-anchor" href="#q-配置未生效" aria-label="Permalink to &quot;Q: 配置未生效&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>规则 pattern 是否正确匹配目标 URL</li><li>Whistle 版本是否满足要求</li><li>配置语法是否正确，特别是 JSON 格式</li><li>是否存在冲突的规则（规则按从上到下顺序合并）</li></ol><h3 id="q-规则合并不符合预期" tabindex="-1">Q: 规则合并不符合预期 <a class="header-anchor" href="#q-规则合并不符合预期" aria-label="Permalink to &quot;Q: 规则合并不符合预期&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>规则的顺序是否正确（从上到下合并）</li><li>不同规则中的配置是否冲突</li><li>使用更具体的 pattern 是否覆盖了通用配置</li></ol>`,86)]))}const g=a(e,[["render",l]]);export{c as __pageData,g as default};
