import{_ as a,c as e,o as s,ag as n}from"./chunks/framework.Bw-5EFTY.js";const m=JSON.parse('{"title":"attachment","description":"","frontmatter":{},"headers":[],"relativePath":"docs/rules/attachment.md","filePath":"docs/rules/attachment.md"}'),l={name:"docs/rules/attachment.md"};function o(i,t,p,d,c,r){return s(),e("div",null,t[0]||(t[0]=[n('<h1 id="attachment" tabindex="-1">attachment <a class="header-anchor" href="#attachment" aria-label="Permalink to &quot;attachment&quot;">​</a></h1><p><code>attachment</code> 协议用于设置响应头中的 <code>Content-Disposition</code> 字段，使浏览器将服务器的响应直接视为附件下载，并将文件保存为 <code>attachment</code> 设定的名称，而不是在页面内展示。</p><blockquote><p>类似 Koa 的 <code>attachment</code> 方法：<a href="https://koajs.com/" target="_blank" rel="noreferrer">https://koajs.com/</a></p></blockquote><h2 id="规则语法" tabindex="-1">规则语法 <a class="header-anchor" href="#规则语法" aria-label="Permalink to &quot;规则语法&quot;">​</a></h2><p><code>attachment</code> 支持多种方式来指定下载文件名：</p><h3 id="_1-内联值-直接指定" tabindex="-1">1. 内联值（直接指定） <a class="header-anchor" href="#_1-内联值-直接指定" aria-label="Permalink to &quot;1. 内联值（直接指定）&quot;">​</a></h3><p>直接在规则中写明文件名。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern attachment://filename [lineProps...] [filters...]</span></span></code></pre></div><p><strong>示例：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://example.com/report attachment://年度报告.pdf</span></span></code></pre></div><h3 id="_2-内嵌值-使用代码块" tabindex="-1">2. 内嵌值（使用代码块） <a class="header-anchor" href="#_2-内嵌值-使用代码块" aria-label="Permalink to &quot;2. 内嵌值（使用代码块）&quot;">​</a></h3><p>当文件名较长或需要复用时可使用此方式。在规则中引用一个自定义键，并在随后的代码块中定义其值。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern attachment://{custom-key} [lineProps...] [filters...]</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>``` custom-key</span></span>\n<span class="line"><span>季度数据-2024Q1.csv</span></span>\n<span class="line"><span>```</span></span></code></pre></div><h3 id="_3-引用-values-中的值" tabindex="-1">3. 引用 Values 中的值 <a class="header-anchor" href="#_3-引用-values-中的值" aria-label="Permalink to &quot;3. 引用 Values 中的值&quot;">​</a></h3><p>引用在界面 <code>Values</code> 中预先定义好的值。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern attachment://{key-of-values} [lineProps...] [filters...]</span></span></code></pre></div><p><strong>前提：</strong> 在 <code>Values</code> 中存在一个名为 <code>key-of-values</code> 的键，其值为目标文件名。</p><h3 id="_4-文件-远程-url-加载" tabindex="-1">4. 文件/远程 URL 加载 <a class="header-anchor" href="#_4-文件-远程-url-加载" aria-label="Permalink to &quot;4. 文件/远程 URL 加载&quot;">​</a></h3><p><strong>当前不支持</strong> 从本地文件或远程 URL 动态加载文件名内容。</p><h2 id="参数详解" tabindex="-1">参数详解 <a class="header-anchor" href="#参数详解" aria-label="Permalink to &quot;参数详解&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">是否必填</th><th style="text-align:left;">描述与示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>pattern</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">用于匹配请求 URL 的表达式。<br>• 支持域名、路径、通配符、正则表达式。<br>• 详见 <a href="./pattern.html">匹配模式文档</a>。</td></tr><tr><td style="text-align:left;"><strong>filename</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">下载时显示的文件名。<br>• 例如：<code>document.pdf</code>, <code>export.xlsx</code>。<br>• 支持通过上述三种方式（内联/内嵌/Values）指定。<br>• ⚠️ 不支持从文件或远程 URL 加载。</td></tr><tr><td style="text-align:left;"><strong>lineProps</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">为规则设置附加属性。<br>• 例如：<code>lineProps://important</code> 可提升此规则的优先级。<br>• 详见 <a href="./lineProps.html">lineProps 文档</a>。</td></tr><tr><td style="text-align:left;"><strong>filters</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">可选的过滤条件，用于精确控制规则生效的场景。<br>• 可匹配请求的 URL、方法、头部、体内容。<br>• 可匹配响应的状态码、头部。<br>• 详见 <a href="./filters.html">过滤器文档</a>。</td></tr></tbody></table><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h2><h3 id="基础示例" tabindex="-1">基础示例 <a class="header-anchor" href="#基础示例" aria-label="Permalink to &quot;基础示例&quot;">​</a></h3><p>让访问 example.com 首页时自动下载一个名为 <code>example.html</code> 的文件。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://www.example.com/ attachment://example.html</span></span></code></pre></div><h3 id="配合过滤器使用" tabindex="-1">配合过滤器使用 <a class="header-anchor" href="#配合过滤器使用" aria-label="Permalink to &quot;配合过滤器使用&quot;">​</a></h3><p>仅当请求包含特定查询参数 <code>download=true</code> 时，才触发 PDF 文件下载。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://api.example.com/document attachment://用户手册.pdf includeFilter:///[?&amp;]download=true/</span></span></code></pre></div><h3 id="使用内嵌值" tabindex="-1">使用内嵌值 <a class="header-anchor" href="#使用内嵌值" aria-label="Permalink to &quot;使用内嵌值&quot;">​</a></h3><p>当文件名比较复杂或需要注释时，使用内嵌代码块更清晰。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://assets.example.com/data.json attachment://{my-file-name}</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>``` my-file-name</span></span>\n<span class="line"><span>配置备份-20240514.json</span></span>\n<span class="line"><span>```</span></span></code></pre></div><h2 id="实现远程加载" tabindex="-1">实现远程加载 <a class="header-anchor" href="#实现远程加载" aria-label="Permalink to &quot;实现远程加载&quot;">​</a></h2><p><code>attachment</code> 协议本身不支持从文件路径或远程 URL 加载值。如果需要实现远程加载功能，有以下两种替代方案：</p><h3 id="_1-通过插件扩展功能" tabindex="-1">1. 通过插件扩展功能 <a class="header-anchor" href="#_1-通过插件扩展功能" aria-label="Permalink to &quot;1. 通过插件扩展功能&quot;">​</a></h3><p>你可以开发插件来实现更复杂的文件名获取逻辑，比如从远程API动态获取文件名。具体开发方法请参考：<a href="./../extensions/dev.html">插件开发文档</a></p><h3 id="_2-使用-url-加载完整规则" tabindex="-1">2. 使用 @url 加载完整规则 <a class="header-anchor" href="#_2-使用-url-加载完整规则" aria-label="Permalink to &quot;2. 使用 @url 加载完整规则&quot;">​</a></h3><p>将包含 <code>attachment</code> 规则的完整配置文件存储在远程服务器上，然后通过 <a href="./@.html"><code>@url</code></a> 协议加载整个规则集。</p><p><strong>示例：</strong></p><ol><li>在远程服务器创建规则文件 <code>xxx.txt</code>：<div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://api.example.com/export attachment://remote-file.csv</span></span>\n<span class="line"><span>https://static.example.com/docs attachment://文档.pdf</span></span></code></pre></div></li><li>在本地 Rules 配置中引用远程规则：<div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@https://remote-url/xxx.txt</span></span></code></pre></div></li></ol><p>这样，远程文件中的 <code>attachment</code> 规则就会被加载生效。</p><h2 id="工作原理与关联协议" tabindex="-1">工作原理与关联协议 <a class="header-anchor" href="#工作原理与关联协议" aria-label="Permalink to &quot;工作原理与关联协议&quot;">​</a></h2><ol><li><p><strong>核心原理</strong>：<code>attachment</code> 协议本质上是自动设置响应头。 上面的示例完全等价于使用 <a href="./resHeaders.html"><code>resHeaders</code></a> 协议手动设置：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://www.example.com/ resHeaders://content-disposition=attachment;filename=&quot;example.html&quot;</span></span></code></pre></div></li><li><p><strong>优势</strong>：相比于直接使用 <code>resHeaders</code>，<code>attachment</code> 语法更简洁、易读，专注于文件下载场景，自动处理文件名转义等细节。</p></li><li><p><strong>注意</strong>：服务器本身返回的响应体内容不会改变。此规则只是通过修改响应头，指示浏览器如何处理这些内容。</p></li></ol>',42)]))}const u=a(l,[["render",o]]);export{m as __pageData,u as default};
