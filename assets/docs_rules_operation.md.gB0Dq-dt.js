import{_ as n}from"./chunks/values-demo1.CKp8x0mH.js";import{_ as t,c as p,o as l,ag as s,j as e,a as i}from"./chunks/framework.Bw-5EFTY.js";const m=JSON.parse('{"title":"operation","description":"","frontmatter":{},"headers":[],"relativePath":"docs/rules/operation.md","filePath":"docs/rules/operation.md"}'),o={name:"docs/rules/operation.md"};function d(r,a,c,h,u,b){return l(),p("div",null,a[0]||(a[0]=[s('<h1 id="operation" tabindex="-1">operation <a class="header-anchor" href="#operation" aria-label="Permalink to &quot;operation&quot;">​</a></h1><p>在 Whistle 中，每条规则由 匹配模式（<code>pattern</code>） 和 操作（<code>operation</code>） 两部分组成，其中 <code>operation</code> 的通用语法为：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>protocol://[value]</span></span></code></pre></div><ul><li><strong>protocol</strong>：指定操作类型（如 <code>file</code>、<code>proxy</code>、<code>resReplace</code> 等）</li><li><strong>value</strong>：操作内容（支持多种格式，见下文）</li></ul><h2 id="内联值" tabindex="-1">内联值 <a class="header-anchor" href="#内联值" aria-label="Permalink to &quot;内联值&quot;">​</a></h2><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern reqHeaders://x-proxy=Whistle   # 设置请求头</span></span>\n<span class="line"><span>pattern statusCode://404               # 修改状态码</span></span>\n<span class="line"><span>pattern file://({&quot;ec&quot;:0})              # 用内联内容（小括号里面的值：`{&quot;ec&quot;:0}`）响应请求</span></span></code></pre></div><p>当操作内容（Value）包含空格、换行符或特殊字符时，无法直接使用内联方式（Inline），需改用以下方法：</p><h2 id="内嵌值" tabindex="-1">内嵌值 <a class="header-anchor" href="#内嵌值" aria-label="Permalink to &quot;内嵌值&quot;">​</a></h2><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>``` ua.txt</span></span>\n<span class="line"><span>Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1</span></span>\n<span class="line"><span>```</span></span>\n<span class="line"><span>pattern ua://{ua.txt}</span></span></code></pre></div><p>等价于</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>``` headers.json</span></span>\n<span class="line"><span>user-agent: Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1</span></span>\n<span class="line"><span>```</span></span>\n<span class="line"><span>pattern reqHeaders://{headers.json}</span></span></code></pre></div><h2 id="values-引用" tabindex="-1">Values 引用 <a class="header-anchor" href="#values-引用" aria-label="Permalink to &quot;Values 引用&quot;">​</a></h2><p>当操作值（Value）需要被多个规则共享时，直接内嵌在规则中会导致无法复用。此时可以将这些值存储在 Whistle 界面的 Values 模块中，并通过键名引用：</p><ol><li>在 Values 里面创建一个名为 <code>result.json</code> 的 key 后，填入操作内容</li><li>在规则里面即可通过 <code>{result.json}</code> 的方式引用，如：<code>www.test.com/cgi-bin/test file://{result.json}</code></li></ol><img src="'+n+'" width="420"><h2 id="文件-远程资源" tabindex="-1">文件/远程资源 <a class="header-anchor" href="#文件-远程资源" aria-label="Permalink to &quot;文件/远程资源&quot;">​</a></h2><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern reqHeaders:///User/xxx/filepath             # 从本地文件加载操作内容</span></span>\n<span class="line"><span>pattern resHeadrs://https://example.com/config.json # 从远处加载 JSON 对象</span></span>\n<span class="line"><span>pattern resHeaders://temp/blank.json                # 通过边境临时文件</span></span></code></pre></div><blockquote><p>⚠️ 注意：http/https/ws/wss/tunnel/host/enable/cache... 等协议禁止通过文件路径或远程 URL 获取内容，详见各协议文档。</p></blockquote><h2 id="临时文件" tabindex="-1">临时文件 <a class="header-anchor" href="#临时文件" aria-label="Permalink to &quot;临时文件&quot;">​</a></h2><p>当需要频繁编辑内容时，可以使用 Whistle 提供的临时文件功能。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern protocol://temp.json</span></span></code></pre></div><p><strong>操作步骤</strong>：</p><ol><li>在 Rules 编辑器中，按住 <code>Command</code>（Mac）/ <code>Ctrl</code>（Windows）</li><li>鼠标点击 <code>protocol://temp.json</code></li><li>在弹出的编辑对话框中输入响应内容</li><li>点击 <code>Save</code> 保存</li></ol><h2 id="小括号用途" tabindex="-1">小括号用途 <a class="header-anchor" href="#小括号用途" aria-label="Permalink to &quot;小括号用途&quot;">​</a></h2><p>在 Whistle 规则中，protocol://value 的 value 部分可能有三种间接引用类型：</p><ol><li><code>{key}</code> - 引用内嵌值</li><li><code>remote-url</code> - 远程资源地址</li><li><code>localfilepath</code> - 本地文件路径</li></ol><p>当需要直接引用上述内容本身（而非它们间接引用内容）作为操作内容时，可以用小括号包裹：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>protocol://(value)</span></span></code></pre></div><p>示例：</p><ol><li><code>reqHeaders:///User/xxx/yyy.txt</code> - 从本地文件 <code>/User/xxx/yyy.txt</code> 加载操作内容</li><li><code>reqHeaders://(/User/xxx/yyy.txt)</code> - 将 <code>/User/xxx/yyy.txt</code> 直接作为操作内容</li></ol><h2 id="模板字符串" tabindex="-1">模板字符串 <a class="header-anchor" href="#模板字符串" aria-label="Permalink to &quot;模板字符串&quot;">​</a></h2><p>Whistle 提供了类似 ES6 的模板字符串功能，允许您动态引用请求信息并应用到规则配置中。支持以下几种模板字符串：</p><h5 id="一般内敛值" tabindex="-1">一般内敛值 <a class="header-anchor" href="#一般内敛值" aria-label="Permalink to &quot;一般内敛值&quot;">​</a></h5><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern protocol://`...${version}...`</span></span></code></pre></div><h5 id="内嵌值或-values-引用" tabindex="-1">内嵌值或 Values 引用 <a class="header-anchor" href="#内嵌值或-values-引用" aria-label="Permalink to &quot;内嵌值或 Values 引用&quot;">​</a></h5><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>\n<span class="line"><span>``` test.key</span></span>\n<span class="line"><span>...${reqId}...</span></span>\n<span class="line"><span>...${version}...</span></span>\n<span class="line"><span>```</span></span>\n<span class="line"><span>pattern protocol://`{test.key}`</span></span></code></pre></div><h5 id="小括号内容" tabindex="-1">小括号内容 <a class="header-anchor" href="#小括号内容" aria-label="Permalink to &quot;小括号内容&quot;">​</a></h5><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern protocol://`(...${now}...)`</span></span></code></pre></div><h5 id="字符串变量" tabindex="-1">字符串变量 <a class="header-anchor" href="#字符串变量" aria-label="Permalink to &quot;字符串变量&quot;">​</a></h5><table tabindex="0"><thead><tr><th>变量名称</th><th>取值</th></tr></thead><tbody><tr><td><code>${now}</code></td><td>Date.now()</td></tr><tr><td><code>${random}</code></td><td>Math.random()</td></tr><tr><td><code>${randomUUID}</code></td><td>crypto.randomUUID()</td></tr><tr><td><code>${randomInt(n)}</code> 或 <code>${randomInt(n1-n2)}</code></td><td>从 [0, n] 或 [n1, n2] 取一个随机正整数 (Added in: v2.9.104)</td></tr><tr><td><code>${reqId}</code></td><td>Whistle 给每个请求分配的 ID</td></tr><tr><td><code>${url.protocol}</code></td><td>url.parse(fullUrl).protocol</td></tr><tr><td><code>${url.hostname}</code></td><td>url.parse(fullUrl).hostname</td></tr><tr><td><code>${url.host}</code></td><td>url.parse(fullUrl).host</td></tr><tr><td><code>${url.port}</code></td><td>url.parse(fullUrl).port</td></tr><tr><td><code>${url.path}</code></td><td>url.parse(fullUrl).path</td></tr><tr><td><code>${url.pathname}</code></td><td>url.parse(fullUrl).pathname</td></tr><tr><td><code>${url.search}</code></td><td>url.parse(fullUrl).search</td></tr><tr><td><code>${query.xxx}</code></td><td>请求参数 <code>xxx</code> 的值</td></tr><tr><td><code>${url}</code></td><td>请求完整 URL</td></tr><tr><td><code>${querystring}</code></td><td>url.parse(fullUrl).search || &#39;?&#39;（不为空）</td></tr><tr><td><code>${searchstring}</code></td><td>url.parse(fullUrl).search || &#39;?&#39;（不为空）</td></tr><tr><td><code>${method}</code></td><td>请求方法</td></tr><tr><td><code>${reqHeaders.xxx}</code></td><td>请求头字段 <code>xxx</code> 的值</td></tr><tr><td><code>${resHeaders.xxx}</code></td><td>响应头字段 <code>xxx</code> 的值</td></tr><tr><td><code>${version}</code></td><td>Whistle 版本号</td></tr><tr><td><code>${port}</code></td><td>Whitle 端口号</td></tr><tr><td><code>${host}</code></td><td>Whistle 启动时监听的网卡 IP（默认为空）</td></tr><tr><td><code>${realPort}</code></td><td>Whistle 界面 Online 对话框显示的 port（一般为 Whistle 端口号）</td></tr><tr><td><code>${realHost}</code></td><td>Whistle 界面 Online 对话框显示的 host（一般为 Whistle 监听的网卡 IP）</td></tr><tr><td><code>${clientIp}</code></td><td>客户端 IP</td></tr><tr><td><code>${clientPort}</code></td><td>客户端端口</td></tr><tr><td><code>${serverIp}</code></td><td>服务端 IP</td></tr><tr><td><code>${serverPort}</code></td><td>服务端端口</td></tr><tr><td><code>${reqCookies.xxx}</code></td><td>请求 cookie <code>xxx</code> 的值</td></tr><tr><td><code>${resCookies.xxx}</code></td><td>响应 cookie <code>xxx</code> 的值</td></tr><tr><td><code>${statusCode}</code></td><td>响应状态码</td></tr><tr><td><code>${env.xxx}</code></td><td>process.env.xxx</td></tr><tr><td><code>${whistle.plugin-name}</code></td><td><code>whistle.plugin-name://value</code> 或 <code>plugin-name://value</code> 的 <code>value</code></td></tr></tbody></table><blockquote><p><code>${whistle.plugin-name}</code> 只在插件的内部规则才可能有值</p></blockquote><h5 id="示例" tabindex="-1">示例 <a class="header-anchor" href="#示例" aria-label="Permalink to &quot;示例&quot;">​</a></h5><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>``` test.txt</span></span>\n<span class="line"><span>now: ${now}</span></span>\n<span class="line"><span>random: ${random}</span></span>\n<span class="line"><span>randomUUID: ${randomUUID}</span></span>\n<span class="line"><span>reqId: ${reqId}</span></span>\n<span class="line"><span>url.protocol: ${url.protocol}</span></span>\n<span class="line"><span>url.hostname: ${url.hostname}</span></span>\n<span class="line"><span>url.host: ${url.host}</span></span>\n<span class="line"><span>url.port: ${url.port}</span></span>\n<span class="line"><span>url.path: ${url.path}</span></span>\n<span class="line"><span>url.pathname: ${url.pathname}</span></span>\n<span class="line"><span>url.search; ${url.search}</span></span>\n<span class="line"><span>query: ${query.name}</span></span>\n<span class="line"><span>url: ${url}</span></span>\n<span class="line"><span>querystring: ${querystring}</span></span>\n<span class="line"><span>searchstring: ${searchstring}</span></span>\n<span class="line"><span>method: ${method}</span></span>\n<span class="line"><span>reqHeaders.accept: ${reqHeaders.accept}</span></span>\n<span class="line"><span>resHeaders.content-type: ${resHeaders.content-type}</span></span>\n<span class="line"><span>version: ${version}</span></span>\n<span class="line"><span>port: ${port}</span></span>\n<span class="line"><span>host: ${host}</span></span>\n<span class="line"><span>realPort: ${realPort}</span></span>\n<span class="line"><span>realHost: ${realHost}</span></span>\n<span class="line"><span>clientIp: ${clientIp}</span></span>\n<span class="line"><span>clientPort: ${clientPort}</span></span>\n<span class="line"><span>serverIp: ${serverIp}</span></span>\n<span class="line"><span>serverPort: ${serverPort}</span></span>\n<span class="line"><span>reqCookies.test: ${reqCookies.test}</span></span>\n<span class="line"><span>resCookies.test: ${resCookies.test}</span></span>\n<span class="line"><span>statusCode: ${statusCode}</span></span>\n<span class="line"><span>env.USER: ${env.USER}</span></span>\n<span class="line"><span>```</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>www.test.com/index.html file://`{test.txt}`</span></span></code></pre></div><p>访问 <code>https://www.test.com/index.html?name=avenwu</code> 则返回响应内容：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>now: 1752301623295</span></span>\n<span class="line"><span>random: 0.6819241513880432</span></span>\n<span class="line"><span>randomUUID: e917b9fc-e2ef-4255-9209-11eb417235c5</span></span>\n<span class="line"><span>reqId: 1752301623294-339</span></span>\n<span class="line"><span>url.protocol: https:</span></span>\n<span class="line"><span>url.hostname: www.test.com</span></span>\n<span class="line"><span>url.host: www.test.com</span></span>\n<span class="line"><span>url.port: </span></span>\n<span class="line"><span>url.path: /index.html?name=avenwu</span></span>\n<span class="line"><span>url.pathname: /index.html</span></span>\n<span class="line"><span>url.search; ?name=avenwu</span></span>\n<span class="line"><span>query: avenwu</span></span>\n<span class="line"><span>url: https://www.test.com/index.html?name=avenwu</span></span>\n<span class="line"><span>querystring: ?name=avenwu</span></span>\n<span class="line"><span>searchstring: ?name=avenwu</span></span>\n<span class="line"><span>method: GET</span></span>\n<span class="line"><span>reqHeaders.accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span>\n<span class="line"><span>resHeaders.content-type: </span></span>\n<span class="line"><span>version: 2.9.100</span></span>\n<span class="line"><span>port: 8899</span></span>\n<span class="line"><span>host: </span></span>\n<span class="line"><span>realPort: 8899</span></span>\n<span class="line"><span>realHost: </span></span>\n<span class="line"><span>clientIp: 127.0.0.1</span></span>\n<span class="line"><span>clientPort: 60582</span></span>\n<span class="line"><span>serverIp: </span></span>\n<span class="line"><span>serverPort: </span></span>\n<span class="line"><span>reqCookies.test: </span></span>\n<span class="line"><span>resCookies.test: </span></span>\n<span class="line"><span>statusCode: </span></span>\n<span class="line"><span>env.USER: av</span></span></code></pre></div><h2 id="数据对象" tabindex="-1">数据对象 <a class="header-anchor" href="#数据对象" aria-label="Permalink to &quot;数据对象&quot;">​</a></h2><p>操作内容除了文本或二进制内容，还有可能是 JSON 对象，Whistle 支持以下 3 种数据对象格式：</p><h4 id="json-格式" tabindex="-1">JSON 格式 <a class="header-anchor" href="#json-格式" aria-label="Permalink to &quot;JSON 格式&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;key1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: value1,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;key2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: value2,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;keyN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: valueN</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="行格式" tabindex="-1">行格式 <a class="header-anchor" href="#行格式" aria-label="Permalink to &quot;行格式&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>key1: value1</span></span>\n<span class="line"><span>key2:value2</span></span>\n<span class="line"><span>keyN: valueN</span></span></code></pre></div><blockquote><p>以 <code>冒号+空格</code> 分隔，如果没有 <code>冒号+空格</code> ，则以第一个冒号分隔，如果没有冒号，则 <code>value</code> 为空字符串</p></blockquote><p><strong>多级嵌套：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>a.b.c: 123</span></span>\n<span class="line"><span>c\\.d\\.e: abc</span></span></code></pre></div><p>等价于：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;c&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;c.d.e&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;abc&quot;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="内联格式-请求参数格式" tabindex="-1">内联格式（请求参数格式） <a class="header-anchor" href="#内联格式-请求参数格式" aria-label="Permalink to &quot;内联格式（请求参数格式）&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>key1=value1&amp;key2=value2&amp;keyN=valueN</span></span></code></pre></div><blockquote><p><code>key</code> 和 <code>value</code> 最好都 <code>encodeURIComponent</code></p></blockquote>',59),e("h2",{"operation-manual":"",id:"常见操作指令速查手册",tabindex:"-1"},[i("常见操作指令速查手册 "),e("a",{class:"header-anchor",href:"#常见操作指令速查手册","aria-label":'Permalink to "常见操作指令速查手册 {operation-manual}"'},"​")],-1),s(`<ul><li><a href="#request">修改请求内容</a><ul><li><a href="#method">修改请求方法</a></li><li><a href="#url">修改请求 URL</a></li><li><a href="#http-version">修改 HTTP 版本</a></li><li><a href="#req-headers">修改请求头</a></li><li><a href="#req-body">修改请求体</a></li></ul></li><li><a href="#response">修改响应内容</a><ul><li><a href="#status-code">修改状态码</a></li><li><a href="#res-headers">修改响应头</a></li><li><a href="#res-body">修改响应体</a></li><li><a href="#trailers">修改尾部响应头</a></li></ul></li><li><a href="#connect">修改连接过程</a><ul><li><a href="#dns">修改 DNS</a></li><li><a href="#proxy">设置代理</a></li><li><a href="#proxy-host">代理和 DNS 同时生效</a></li></ul></li><li><a href="#tools">页面调试工具</a><ul><li><a href="#weinre">查看页面 DOM 结构</a></li><li><a href="#log">查看页面日志及错误信息</a></li></ul></li></ul><hr><h2 id="request" tabindex="-1">一、修改请求内容 <a class="header-anchor" href="#request" aria-label="Permalink to &quot;一、修改请求内容 {#request}&quot;">​</a></h2><h3 id="method" tabindex="-1">1.1 修改请求方法 <a class="header-anchor" href="#method" aria-label="Permalink to &quot;1.1 修改请求方法 {#method}&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 基础语法</span></span>
<span class="line"><span>pattern method://新方法</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 示例</span></span>
<span class="line"><span>www.example.com/path method://post</span></span></code></pre></div><p><strong>数据来源支持：</strong></p><ul><li>直接指定：<code>method://get</code></li><li>内嵌值：<code>method://{keyOfEmbedded}</code></li><li>Values配置：<code>method://{keyOfValues}</code></li></ul><p><strong>注意事项：</strong></p><ul><li>方法名不区分大小写</li><li>不支持从本地文件或远程URL获取</li></ul><p><strong>实用示例：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 示例1：将所有请求方法改为POST</span></span>
<span class="line"><span>www.example.com/path method://post</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 示例2：仅将PUT请求改为POST</span></span>
<span class="line"><span>www.example.com/path method://post includeFilter://m:put</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 示例3：根据请求体内容修改方法</span></span>
<span class="line"><span>www.example.com/api method://put includeFilter://b:cmdname=test</span></span></code></pre></div><h3 id="url" tabindex="-1">1.2 修改请求 URL <a class="header-anchor" href="#url" aria-label="Permalink to &quot;1.2 修改请求 URL {#url}&quot;">​</a></h3><h4 id="url映射" tabindex="-1">URL映射 <a class="header-anchor" href="#url映射" aria-label="Permalink to &quot;URL映射&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/path/to www.test.com/test</span></span></code></pre></div><p><strong>映射效果：</strong></p><ul><li><code>https://www.example.com/path/to?query=abc</code> → <code>https://www.test.com/test?query=abc</code></li><li><code>https://www.example.com/path/to/subpage</code> → <code>https://www.test.com/test/subpage</code></li><li><code>wss://www.example.com/path/to/api</code> → <code>wss://www.test.com/test/api</code></li></ul><h4 id="修改请求参数" tabindex="-1">修改请求参数 <a class="header-anchor" href="#修改请求参数" aria-label="Permalink to &quot;修改请求参数&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 新增/替换参数</span></span>
<span class="line"><span>pattern urlParams://({&quot;key&quot;:&quot;value&quot;})</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 删除参数</span></span>
<span class="line"><span>pattern delete://urlParams.paramName</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 示例：修改参数并删除指定参数</span></span>
<span class="line"><span>www.example.com/api urlParams://({&quot;cmdname&quot;:&quot;Test&quot;}) delete://urlParams.oldParam</span></span></code></pre></div><h4 id="修改path路径" tabindex="-1">修改Path路径 <a class="header-anchor" href="#修改path路径" aria-label="Permalink to &quot;修改Path路径&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 正则替换</span></span>
<span class="line"><span>pattern pathReplace://({&quot;/old/ig&quot;:&quot;new&quot;})</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 关键字替换</span></span>
<span class="line"><span>pattern pathReplace://({&quot;old&quot;:&quot;new&quot;})</span></span></code></pre></div><p><strong>数据来源支持：</strong></p><ul><li>内联JSON</li><li>内嵌值</li><li>Values配置</li><li>本地文件</li><li>远程URL</li></ul><h3 id="http-version" tabindex="-1">1.3 修改 HTTP 版本 <a class="header-anchor" href="#http-version" aria-label="Permalink to &quot;1.3 修改 HTTP 版本 {#http-version}&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 强制使用普通HTTPS（禁用HTTP/2）</span></span>
<span class="line"><span>pattern disable://h2</span></span></code></pre></div><blockquote><p>默认会尝试使用HTTP/2建立连接，不支持时自动降级为HTTPS</p></blockquote><h3 id="req-headers" tabindex="-1">1.4 修改请求头 <a class="header-anchor" href="#req-headers" aria-label="Permalink to &quot;1.4 修改请求头 {#req-headers}&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 新增/替换请求头</span></span>
<span class="line"><span>pattern reqHeaders://({&quot;Header-Name&quot;:&quot;value&quot;})</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 删除请求头</span></span>
<span class="line"><span>pattern delete://reqHeaders.headerName</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 示例</span></span>
<span class="line"><span>www.example.com reqHeaders://({&quot;X-Custom-Header&quot;:&quot;test&quot;})</span></span></code></pre></div><h3 id="req-body" tabindex="-1">1.5 修改请求体 <a class="header-anchor" href="#req-body" aria-label="Permalink to &quot;1.5 修改请求体 {#req-body}&quot;">​</a></h3><h4 id="合并修改-json-表单" tabindex="-1">合并修改（JSON/表单） <a class="header-anchor" href="#合并修改-json-表单" aria-label="Permalink to &quot;合并修改（JSON/表单）&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern reqMerge://({&quot;newField&quot;:&quot;value&quot;})</span></span></code></pre></div><h4 id="文本替换" tabindex="-1">文本替换 <a class="header-anchor" href="#文本替换" aria-label="Permalink to &quot;文本替换&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 正则替换</span></span>
<span class="line"><span>pattern reqReplace://({&quot;/search/ig&quot;:&quot;replace&quot;})</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 关键字替换</span></span>
<span class="line"><span>pattern reqReplace://({&quot;search&quot;:&quot;replace&quot;})</span></span></code></pre></div><h4 id="完全替换" tabindex="-1">完全替换 <a class="header-anchor" href="#完全替换" aria-label="Permalink to &quot;完全替换&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern reqBody://(新内容)</span></span></code></pre></div><h4 id="删除操作" tabindex="-1">删除操作 <a class="header-anchor" href="#删除操作" aria-label="Permalink to &quot;删除操作&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 删除特定字段</span></span>
<span class="line"><span>pattern delete://reqBody.fieldName</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 删除整个请求体</span></span>
<span class="line"><span>pattern delete://reqBody</span></span></code></pre></div><p><strong>数据来源支持：</strong></p><ul><li>内联值</li><li>内嵌值</li><li>Values配置</li><li>本地文件</li><li>远程URL</li></ul><hr><h2 id="response" tabindex="-1">二、修改响应内容 <a class="header-anchor" href="#response" aria-label="Permalink to &quot;二、修改响应内容 {#response}&quot;">​</a></h2><h3 id="status-code" tabindex="-1">2.1 修改状态码 <a class="header-anchor" href="#status-code" aria-label="Permalink to &quot;2.1 修改状态码 {#status-code}&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 替换现有响应状态码（请求会到达服务器）</span></span>
<span class="line"><span>pattern replaceStatus://500</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 直接响应状态码（请求不发送到服务器）</span></span>
<span class="line"><span>pattern statusCode://500</span></span></code></pre></div><h3 id="res-headers" tabindex="-1">2.2 修改响应头 <a class="header-anchor" href="#res-headers" aria-label="Permalink to &quot;2.2 修改响应头 {#res-headers}&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 新增/替换响应头</span></span>
<span class="line"><span>pattern resHeaders://({&quot;Header-Name&quot;:&quot;value&quot;})</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 删除响应头</span></span>
<span class="line"><span>pattern delete://resHeaders.headerName</span></span></code></pre></div><h3 id="res-body" tabindex="-1">2.3 修改响应体 <a class="header-anchor" href="#res-body" aria-label="Permalink to &quot;2.3 修改响应体 {#res-body}&quot;">​</a></h3><h4 id="合并修改-json-jsonp" tabindex="-1">合并修改（JSON/JSONP） <a class="header-anchor" href="#合并修改-json-jsonp" aria-label="Permalink to &quot;合并修改（JSON/JSONP）&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern resMerge://({&quot;newData&quot;:&quot;value&quot;})</span></span></code></pre></div><h4 id="文本替换-1" tabindex="-1">文本替换 <a class="header-anchor" href="#文本替换-1" aria-label="Permalink to &quot;文本替换&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern resReplace://({&quot;/old/ig&quot;:&quot;new&quot;})</span></span></code></pre></div><h4 id="替换响应体" tabindex="-1">替换响应体 <a class="header-anchor" href="#替换响应体" aria-label="Permalink to &quot;替换响应体&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 替换服务器返回的内容</span></span>
<span class="line"><span>pattern resBody://(新内容)</span></span></code></pre></div><h4 id="直接响应内容" tabindex="-1">直接响应内容 <a class="header-anchor" href="#直接响应内容" aria-label="Permalink to &quot;直接响应内容&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 请求不发送到服务器</span></span>
<span class="line"><span>pattern file://(直接返回的内容) resType://html</span></span></code></pre></div><h4 id="删除操作-1" tabindex="-1">删除操作 <a class="header-anchor" href="#删除操作-1" aria-label="Permalink to &quot;删除操作&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 删除响应体字段</span></span>
<span class="line"><span>pattern delete://resBody.fieldName</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 清空响应体</span></span>
<span class="line"><span>pattern delete://resBody</span></span></code></pre></div><h3 id="trailers" tabindex="-1">2.4 修改尾部响应头 <a class="header-anchor" href="#trailers" aria-label="Permalink to &quot;2.4 修改尾部响应头 {#trailers}&quot;">​</a></h3><blockquote><p>Trailers是在分块传输响应后发送的额外头部字段</p></blockquote><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 新增/替换Trailers</span></span>
<span class="line"><span>pattern trailers://({&quot;Trailer-Name&quot;:&quot;value&quot;})</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 删除Trailers</span></span>
<span class="line"><span>pattern delete://trailers.trailerName</span></span></code></pre></div><hr><h2 id="connect" tabindex="-1">三、修改连接过程 <a class="header-anchor" href="#connect" aria-label="Permalink to &quot;三、修改连接过程 {#connect}&quot;">​</a></h2><h3 id="dns" tabindex="-1">3.1 修改 DNS <a class="header-anchor" href="#dns" aria-label="Permalink to &quot;3.1 修改 DNS {#dns}&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 设置IP地址</span></span>
<span class="line"><span>pattern 127.0.0.1</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 设置IP和端口</span></span>
<span class="line"><span>pattern 127.0.0.1:8080</span></span>
<span class="line"><span></span></span>
<span class="line"><span># CNAME效果（指向其他主机）</span></span>
<span class="line"><span>pattern host://www.target.com:8080</span></span></code></pre></div><h3 id="proxy" tabindex="-1">3.2 设置代理 <a class="header-anchor" href="#proxy" aria-label="Permalink to &quot;3.2 设置代理 {#proxy}&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># HTTP代理</span></span>
<span class="line"><span>pattern proxy://127.0.0.1:8080</span></span>
<span class="line"><span></span></span>
<span class="line"><span># SOCKS5代理</span></span>
<span class="line"><span>pattern socks://127.0.0.1:1080</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 支持域名</span></span>
<span class="line"><span>pattern proxy://proxy.example.com:8080</span></span></code></pre></div><h3 id="proxy-host" tabindex="-1">3.3 代理和 DNS 同时生效 <a class="header-anchor" href="#proxy-host" aria-label="Permalink to &quot;3.3 代理和 DNS 同时生效 {#proxy-host}&quot;">​</a></h3><p><strong>优先级说明：</strong></p><ul><li>默认：host配置优先于proxy</li><li>可调整：通过<code>lineProps://proxyHost</code>让两者同时生效</li></ul><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 示例1：只生效host配置</span></span>
<span class="line"><span>pattern 127.0.0.1:8080 socks://10.1.1.1:1080</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 示例2：只生效proxy配置</span></span>
<span class="line"><span>pattern 127.0.0.1:8080 socks://10.1.1.1:1080 ignore://host</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 示例3：host和proxy同时生效</span></span>
<span class="line"><span>pattern 127.0.0.1:8080 socks://10.1.1.1:1080 lineProps://proxyHost</span></span></code></pre></div><hr><h2 id="tools" tabindex="-1">四、页面调试工具 <a class="header-anchor" href="#tools" aria-label="Permalink to &quot;四、页面调试工具 {#tools}&quot;">​</a></h2><h3 id="weinre" tabindex="-1">4.1 查看页面 DOM 结构 <a class="header-anchor" href="#weinre" aria-label="Permalink to &quot;4.1 查看页面 DOM 结构 {#weinre}&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern weinre://调试会话名称</span></span></code></pre></div><blockquote><p>详细用法参考：<a href="./weinre.html">weinre文档</a></p></blockquote><h3 id="log" tabindex="-1">4.2 查看页面日志及错误信息 <a class="header-anchor" href="#log" aria-label="Permalink to &quot;4.2 查看页面日志及错误信息 {#log}&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern log://日志会话名称</span></span></code></pre></div><blockquote><p>详细用法参考：<a href="./log.html">log文档</a></p></blockquote><hr><h2 id="数据来源速查表" tabindex="-1">数据来源速查表 <a class="header-anchor" href="#数据来源速查表" aria-label="Permalink to &quot;数据来源速查表&quot;">​</a></h2><table tabindex="0"><thead><tr><th>操作类型</th><th>直接内联</th><th>内嵌值</th><th>Values</th><th>本地文件</th><th>远程URL</th></tr></thead><tbody><tr><td>请求方法</td><td>✓</td><td>✓</td><td>✓</td><td>✗</td><td>✗</td></tr><tr><td>URL参数</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>请求头</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>请求体</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>响应头</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>响应体</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>Trailers</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr></tbody></table><p><strong>语法示例：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 直接内联</span></span>
<span class="line"><span>protocol://({&quot;key&quot;:&quot;value&quot;})</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 内嵌值</span></span>
<span class="line"><span>protocol://{embeddedKey}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Values配置</span></span>
<span class="line"><span>protocol://{valuesKey}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 本地文件</span></span>
<span class="line"><span>protocol:///path/to/file.json</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 远程URL</span></span>
<span class="line"><span>protocol://https://example.com/data.json</span></span></code></pre></div><hr><h2 id="常用过滤条件" tabindex="-1">常用过滤条件 <a class="header-anchor" href="#常用过滤条件" aria-label="Permalink to &quot;常用过滤条件&quot;">​</a></h2><table tabindex="0"><thead><tr><th>过滤器</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>includeFilter://m:方法</code></td><td>按请求方法过滤</td><td><code>includeFilter://m:put</code></td></tr><tr><td><code>includeFilter://b:内容</code></td><td>按请求体内容过滤</td><td><code>includeFilter://b:cmdname=test</code></td></tr><tr><td>正则表达式</td><td>区分大小写匹配</td><td><code>/Test/</code></td></tr></tbody></table><blockquote><p><strong>提示：</strong> 更多协议和高级用法请参考<a href="./protocols.html">完整协议列表</a></p></blockquote>`,85)]))}const x=t(o,[["render",d]]);export{m as __pageData,x as default};
