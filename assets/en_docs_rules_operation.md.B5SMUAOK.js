import{_ as a}from"./chunks/values-demo1.CKp8x0mH.js";import{_ as s,c as n,o as t,ag as o}from"./chunks/framework.Bw-5EFTY.js";const g=JSON.parse('{"title":"operation","description":"","frontmatter":{},"headers":[],"relativePath":"en/docs/rules/operation.md","filePath":"en/docs/rules/operation.md"}'),l={name:"en/docs/rules/operation.md"};function p(i,e,r,d,c,h){return t(),n("div",null,e[0]||(e[0]=[o('<h1 id="operation" tabindex="-1">operation <a class="header-anchor" href="#operation" aria-label="Permalink to &quot;operation&quot;">​</a></h1><p>In Whistle, each rule consists of two parts: <strong>Pattern</strong> (<code>pattern</code>) and <strong>Operation</strong> (<code>operation</code>). The general syntax for <code>operation</code> is:</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>protocol://[value]</span></span></code></pre></div><ul><li><strong>protocol</strong>: Specifies the operation type (such as <code>file</code>, <code>proxy</code>, <code>resReplace</code>, etc.)</li><li><strong>value</strong>: Operation content (supports multiple formats, see below)</li></ul><h2 id="inline-values" tabindex="-1">Inline Values <a class="header-anchor" href="#inline-values" aria-label="Permalink to &quot;Inline Values&quot;">​</a></h2><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern reqHeaders://x-proxy=Whistle   # Set request headers</span></span>\n<span class="line"><span>pattern statusCode://404               # Modify status code</span></span>\n<span class="line"><span>pattern file://({&quot;ec&quot;:0})              # Respond with inline content (value inside parentheses: `{&quot;ec&quot;:0}`)</span></span></code></pre></div><p>When the operation content (Value) contains spaces, line breaks, or special characters, inline method cannot be used directly. Use the following alternative methods instead:</p><h2 id="embedded-values" tabindex="-1">Embedded Values <a class="header-anchor" href="#embedded-values" aria-label="Permalink to &quot;Embedded Values&quot;">​</a></h2><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>``` ua.txt</span></span>\n<span class="line"><span>Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1</span></span>\n<span class="line"><span>```</span></span>\n<span class="line"><span>pattern ua://{ua.txt}</span></span></code></pre></div><p>Equivalent to:</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>``` headers.json</span></span>\n<span class="line"><span>user-agent: Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1</span></span>\n<span class="line"><span>```</span></span>\n<span class="line"><span>pattern reqHeaders://{headers.json}</span></span></code></pre></div><h2 id="values-references" tabindex="-1">Values References <a class="header-anchor" href="#values-references" aria-label="Permalink to &quot;Values References&quot;">​</a></h2><p>When operation values (Value) need to be shared by multiple rules, embedding them directly in rules makes them non-reusable. In such cases, these values can be stored in the Values module of the Whistle interface and referenced by key name:</p><ol><li>Create a key named <code>result.json</code> in Values and fill in the operation content</li><li>In rules, reference it via <code>{result.json}</code>, e.g.: <code>www.test.com/cgi-bin/test file://{result.json}</code></li></ol><img src="'+a+'" width="420"><h2 id="file-remote-resources" tabindex="-1">File/Remote Resources <a class="header-anchor" href="#file-remote-resources" aria-label="Permalink to &quot;File/Remote Resources&quot;">​</a></h2><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern reqHeaders:///User/xxx/filepath             # Load operation content from local file</span></span>\n<span class="line"><span>pattern resHeadrs://https://example.com/config.json # Load JSON object from remote URL</span></span>\n<span class="line"><span>pattern resHeaders://temp/blank.json                # Through editing temporary files</span></span></code></pre></div><blockquote><p>⚠️ Note: Protocols like http/https/ws/wss/tunnel/host/enable/cache... prohibit obtaining content via file paths or remote URLs. See each protocol&#39;s documentation for details.</p></blockquote><h2 id="temporary-files" tabindex="-1">Temporary Files <a class="header-anchor" href="#temporary-files" aria-label="Permalink to &quot;Temporary Files&quot;">​</a></h2><p>When frequent content editing is needed, you can use Whistle&#39;s temporary file functionality.</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern protocol://temp.json</span></span></code></pre></div><p><strong>Operation Steps</strong>:</p><ol><li>In the Rules editor, hold <code>Command</code> (Mac) / <code>Ctrl</code> (Windows)</li><li>Click with mouse on <code>protocol://temp.json</code></li><li>Enter the response content in the pop-up editing dialog</li><li>Click <code>Save</code> to save</li></ol><h2 id="parentheses-usage" tabindex="-1">Parentheses Usage <a class="header-anchor" href="#parentheses-usage" aria-label="Permalink to &quot;Parentheses Usage&quot;">​</a></h2><p>In Whistle rules, the value part of <code>protocol://value</code> can have three types of indirect references:</p><ol><li><code>{key}</code> - Reference embedded values</li><li><code>remote-url</code> - Remote resource address</li><li><code>localfilepath</code> - Local file path</li></ol><p>When you need to directly reference the above content itself (rather than what they indirectly reference) as operation content, you can wrap it with parentheses:</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>protocol://(value)</span></span></code></pre></div><p>Examples:</p><ol><li><code>reqHeaders:///User/xxx/yyy.txt</code> - Load operation content from local file <code>/User/xxx/yyy.txt</code></li><li><code>reqHeaders://(/User/xxx/yyy.txt)</code> - Treat <code>/User/xxx/yyy.txt</code> directly as operation content</li></ol><h2 id="template-strings" tabindex="-1">Template Strings <a class="header-anchor" href="#template-strings" aria-label="Permalink to &quot;Template Strings&quot;">​</a></h2><p>Whistle provides template string functionality similar to ES6, allowing you to dynamically reference request information and apply it to rule configurations. Supports the following template string types:</p><h5 id="general-inline-values" tabindex="-1">General Inline Values <a class="header-anchor" href="#general-inline-values" aria-label="Permalink to &quot;General Inline Values&quot;">​</a></h5><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern protocol://`...${version}...`</span></span></code></pre></div><h5 id="embedded-values-or-values-references" tabindex="-1">Embedded Values or Values References <a class="header-anchor" href="#embedded-values-or-values-references" aria-label="Permalink to &quot;Embedded Values or Values References&quot;">​</a></h5><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>``` test.key</span></span>\n<span class="line"><span>...${reqId}...</span></span>\n<span class="line"><span>...${version}...</span></span>\n<span class="line"><span>```</span></span>\n<span class="line"><span>pattern protocol://`{test.key}`</span></span></code></pre></div><h5 id="parenthesized-content" tabindex="-1">Parenthesized Content <a class="header-anchor" href="#parenthesized-content" aria-label="Permalink to &quot;Parenthesized Content&quot;">​</a></h5><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern protocol://`(...${now}...)`</span></span></code></pre></div><h5 id="string-variables" tabindex="-1">String Variables <a class="header-anchor" href="#string-variables" aria-label="Permalink to &quot;String Variables&quot;">​</a></h5><table tabindex="0"><thead><tr><th>Variable Name</th><th>Value</th></tr></thead><tbody><tr><td><code>${now}</code></td><td>Date.now()</td></tr><tr><td><code>${random}</code></td><td>Math.random()</td></tr><tr><td><code>${randomUUID}</code></td><td>crypto.randomUUID()</td></tr><tr><td><code>${randomInt(n)}</code> or <code>${randomInt(n1-n2)}</code></td><td>Get a random positive integer from [0, n] or [n1, n2] (Added in: v2.9.104)</td></tr><tr><td><code>${reqId}</code></td><td>ID assigned by Whistle to each request</td></tr><tr><td><code>${url.protocol}</code></td><td>url.parse(fullUrl).protocol</td></tr><tr><td><code>${url.hostname}</code></td><td>url.parse(fullUrl).hostname</td></tr><tr><td><code>${url.host}</code></td><td>url.parse(fullUrl).host</td></tr><tr><td><code>${url.port}</code></td><td>url.parse(fullUrl).port</td></tr><tr><td><code>${url.path}</code></td><td>url.parse(fullUrl).path</td></tr><tr><td><code>${url.pathname}</code></td><td>url.parse(fullUrl).pathname</td></tr><tr><td><code>${url.search}</code></td><td>url.parse(fullUrl).search</td></tr><tr><td><code>${query.xxx}</code></td><td>Value of request parameter <code>xxx</code></td></tr><tr><td><code>${url}</code></td><td>Complete request URL</td></tr><tr><td><code>${querystring}</code></td><td>url.parse(fullUrl).search || &#39;?&#39; (not empty)</td></tr><tr><td><code>${searchstring}</code></td><td>url.parse(fullUrl).search || &#39;?&#39; (not empty)</td></tr><tr><td><code>${method}</code></td><td>Request method</td></tr><tr><td><code>${reqHeaders.xxx}</code></td><td>Value of request header field <code>xxx</code></td></tr><tr><td><code>${resHeaders.xxx}</code></td><td>Value of response header field <code>xxx</code></td></tr><tr><td><code>${version}</code></td><td>Whistle version number</td></tr><tr><td><code>${port}</code></td><td>Whistle port number</td></tr><tr><td><code>${host}</code></td><td>Network interface IP that Whistle listens on (empty by default)</td></tr><tr><td><code>${realPort}</code></td><td>port displayed in Whistle interface&#39;s Online dialog (usually Whistle port number)</td></tr><tr><td><code>${realHost}</code></td><td>host displayed in Whistle interface&#39;s Online dialog (usually the network interface IP that Whistle listens on)</td></tr><tr><td><code>${clientIp}</code></td><td>Client IP</td></tr><tr><td><code>${clientPort}</code></td><td>Client port</td></tr><tr><td><code>${serverIp}</code></td><td>Server IP</td></tr><tr><td><code>${serverPort}</code></td><td>Server port</td></tr><tr><td><code>${reqCookies.xxx}</code></td><td>Value of request cookie <code>xxx</code></td></tr><tr><td><code>${resCookies.xxx}</code></td><td>Value of response cookie <code>xxx</code></td></tr><tr><td><code>${statusCode}</code></td><td>Response status code</td></tr><tr><td><code>${env.xxx}</code></td><td>process.env.xxx</td></tr><tr><td><code>${whistle.plugin-name}</code></td><td><code>value</code> of <code>whistle.plugin-name://value</code> or <code>plugin-name://value</code></td></tr></tbody></table><blockquote><p><code>${whistle.plugin-name}</code> may only have values in internal rules of plugins</p></blockquote><h5 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example&quot;">​</a></h5><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>``` test.txt</span></span>\n<span class="line"><span>now: ${now}</span></span>\n<span class="line"><span>random: ${random}</span></span>\n<span class="line"><span>randomUUID: ${randomUUID}</span></span>\n<span class="line"><span>reqId: ${reqId}</span></span>\n<span class="line"><span>url.protocol: ${url.protocol}</span></span>\n<span class="line"><span>url.hostname: ${url.hostname}</span></span>\n<span class="line"><span>url.host: ${url.host}</span></span>\n<span class="line"><span>url.port: ${url.port}</span></span>\n<span class="line"><span>url.path: ${url.path}</span></span>\n<span class="line"><span>url.pathname: ${url.pathname}</span></span>\n<span class="line"><span>url.search; ${url.search}</span></span>\n<span class="line"><span>query: ${query.name}</span></span>\n<span class="line"><span>url: ${url}</span></span>\n<span class="line"><span>querystring: ${querystring}</span></span>\n<span class="line"><span>searchstring: ${searchstring}</span></span>\n<span class="line"><span>method: ${method}</span></span>\n<span class="line"><span>reqHeaders.accept: ${reqHeaders.accept}</span></span>\n<span class="line"><span>resHeaders.content-type: ${resHeaders.content-type}</span></span>\n<span class="line"><span>version: ${version}</span></span>\n<span class="line"><span>port: ${port}</span></span>\n<span class="line"><span>host: ${host}</span></span>\n<span class="line"><span>realPort: ${realPort}</span></span>\n<span class="line"><span>realHost: ${realHost}</span></span>\n<span class="line"><span>clientIp: ${clientIp}</span></span>\n<span class="line"><span>clientPort: ${clientPort}</span></span>\n<span class="line"><span>serverIp: ${serverIp}</span></span>\n<span class="line"><span>serverPort: ${serverPort}</span></span>\n<span class="line"><span>reqCookies.test: ${reqCookies.test}</span></span>\n<span class="line"><span>resCookies.test: ${resCookies.test}</span></span>\n<span class="line"><span>statusCode: ${statusCode}</span></span>\n<span class="line"><span>env.USER: ${env.USER}</span></span>\n<span class="line"><span>```</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>www.test.com/index.html file://`{test.txt}`</span></span></code></pre></div><p>Accessing <code>https://www.test.com/index.html?name=avenwu</code> returns response content:</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>now: 1752301623295</span></span>\n<span class="line"><span>random: 0.6819241513880432</span></span>\n<span class="line"><span>randomUUID: e917b9fc-e2ef-4255-9209-11eb417235c5</span></span>\n<span class="line"><span>reqId: 1752301623294-339</span></span>\n<span class="line"><span>url.protocol: https:</span></span>\n<span class="line"><span>url.hostname: www.test.com</span></span>\n<span class="line"><span>url.host: www.test.com</span></span>\n<span class="line"><span>url.port: </span></span>\n<span class="line"><span>url.path: /index.html?name=avenwu</span></span>\n<span class="line"><span>url.pathname: /index.html</span></span>\n<span class="line"><span>url.search; ?name=avenwu</span></span>\n<span class="line"><span>query: avenwu</span></span>\n<span class="line"><span>url: https://www.test.com/index.html?name=avenwu</span></span>\n<span class="line"><span>querystring: ?name=avenwu</span></span>\n<span class="line"><span>searchstring: ?name=avenwu</span></span>\n<span class="line"><span>method: GET</span></span>\n<span class="line"><span>reqHeaders.accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span>\n<span class="line"><span>resHeaders.content-type: </span></span>\n<span class="line"><span>version: 2.9.100</span></span>\n<span class="line"><span>port: 8899</span></span>\n<span class="line"><span>host: </span></span>\n<span class="line"><span>realPort: 8899</span></span>\n<span class="line"><span>realHost: </span></span>\n<span class="line"><span>clientIp: 127.0.0.1</span></span>\n<span class="line"><span>clientPort: 60582</span></span>\n<span class="line"><span>serverIp: </span></span>\n<span class="line"><span>serverPort: </span></span>\n<span class="line"><span>reqCookies.test: </span></span>\n<span class="line"><span>resCookies.test: </span></span>\n<span class="line"><span>statusCode: </span></span>\n<span class="line"><span>env.USER: av</span></span></code></pre></div><h2 id="data-objects" tabindex="-1">Data Objects <a class="header-anchor" href="#data-objects" aria-label="Permalink to &quot;Data Objects&quot;">​</a></h2><p>Operation content can be not only text or binary content but also JSON objects. Whistle supports the following 3 data object formats:</p><h4 id="json-format" tabindex="-1">JSON Format <a class="header-anchor" href="#json-format" aria-label="Permalink to &quot;JSON Format&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;key1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: value1,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;key2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: value2,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;keyN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: valueN</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="line-format" tabindex="-1">Line Format <a class="header-anchor" href="#line-format" aria-label="Permalink to &quot;Line Format&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>key1: value1</span></span>\n<span class="line"><span>key2:value2</span></span>\n<span class="line"><span>keyN: valueN</span></span></code></pre></div><blockquote><p>Separated by <code>colon + space</code>. If there&#39;s no <code>colon + space</code>, then separated by the first colon. If there&#39;s no colon, then <code>value</code> is an empty string</p></blockquote><p><strong>Multi-level nesting:</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>a.b.c: 123</span></span>\n<span class="line"><span>c\\.d\\.e: abc</span></span></code></pre></div><p>Equivalent to:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;c&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;c.d.e&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;abc&quot;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="inline-format-request-parameter-format" tabindex="-1">Inline Format (Request Parameter Format) <a class="header-anchor" href="#inline-format-request-parameter-format" aria-label="Permalink to &quot;Inline Format (Request Parameter Format)&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>key1=value1&amp;key2=value2&amp;keyN=valueN</span></span></code></pre></div><blockquote><p>Both <code>key</code> and <code>value</code> should ideally be <code>encodeURIComponent</code></p></blockquote><h2 id="operation-protocols" tabindex="-1">Operation Protocols <a class="header-anchor" href="#operation-protocols" aria-label="Permalink to &quot;Operation Protocols&quot;">​</a></h2><p>Each protocol (<code>protocol</code>) corresponds to a specific operation type, used to perform corresponding processing on matched requests. The protocol determines the operation type and the format requirements for operation content. For specific usage, refer to: <a href="./protocols.html">Protocol List</a></p>',61)]))}const b=s(l,[["render",p]]);export{g as __pageData,b as default};
