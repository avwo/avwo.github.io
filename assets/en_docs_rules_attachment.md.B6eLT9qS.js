import{_ as t,c as a,o as s,ag as n}from"./chunks/framework.Bw-5EFTY.js";const m=JSON.parse('{"title":"attachment","description":"","frontmatter":{},"headers":[],"relativePath":"en/docs/rules/attachment.md","filePath":"en/docs/rules/attachment.md"}'),o={name:"en/docs/rules/attachment.md"};function l(i,e,r,d,c,p){return s(),a("div",null,e[0]||(e[0]=[n('<h1 id="attachment" tabindex="-1">attachment <a class="header-anchor" href="#attachment" aria-label="Permalink to &quot;attachment&quot;">​</a></h1><p>The <code>attachment</code> protocol is used to set the <code>Content-Disposition</code> field in the response headers, instructing the browser to treat the server&#39;s response directly as an attachment for download and save the file with the name specified by <code>attachment</code>, instead of displaying it within the page.</p><blockquote><p>Similar to Koa&#39;s <code>attachment</code> method: <a href="https://koajs.com/" target="_blank" rel="noreferrer">https://koajs.com/</a></p></blockquote><h2 id="rule-syntax" tabindex="-1">Rule Syntax <a class="header-anchor" href="#rule-syntax" aria-label="Permalink to &quot;Rule Syntax&quot;">​</a></h2><p><code>attachment</code> supports multiple ways to specify the download filename:</p><h3 id="_1-inline-value-direct-specification" tabindex="-1">1. Inline Value (Direct Specification) <a class="header-anchor" href="#_1-inline-value-direct-specification" aria-label="Permalink to &quot;1. Inline Value (Direct Specification)&quot;">​</a></h3><p>Write the filename directly in the rule.</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern attachment://filename [lineProps...] [filters...]</span></span></code></pre></div><p><strong>Example:</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://example.com/report attachment://Annual-Report.pdf</span></span></code></pre></div><h3 id="_2-embedded-value-using-code-block" tabindex="-1">2. Embedded Value (Using Code Block) <a class="header-anchor" href="#_2-embedded-value-using-code-block" aria-label="Permalink to &quot;2. Embedded Value (Using Code Block)&quot;">​</a></h3><p>Use this method when the filename is long or needs to be reused. Reference a custom key in the rule and define its value in a subsequent code block.</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern attachment://{custom-key} [lineProps...] [filters...]</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>``` custom-key</span></span>\n<span class="line"><span>Quarterly-Data-2024Q1.csv</span></span>\n<span class="line"><span>```</span></span></code></pre></div><h3 id="_3-referencing-a-value-from-the-values-panel" tabindex="-1">3. Referencing a Value from the Values Panel <a class="header-anchor" href="#_3-referencing-a-value-from-the-values-panel" aria-label="Permalink to &quot;3. Referencing a Value from the Values Panel&quot;">​</a></h3><p>Reference a value pre-defined in the <code>Values</code> panel.</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern attachment://{key-of-values} [lineProps...] [filters...]</span></span></code></pre></div><p><strong>Prerequisite:</strong> A key named <code>key-of-values</code> with the target filename as its value must exist in <code>Values</code>.</p><h3 id="_4-file-remote-url-loading" tabindex="-1">4. File/Remote URL Loading <a class="header-anchor" href="#_4-file-remote-url-loading" aria-label="Permalink to &quot;4. File/Remote URL Loading&quot;">​</a></h3><p><strong>Currently NOT supported</strong> to dynamically load filename content from a local file or remote URL.</p><h2 id="parameter-details" tabindex="-1">Parameter Details <a class="header-anchor" href="#parameter-details" aria-label="Permalink to &quot;Parameter Details&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">Parameter</th><th style="text-align:left;">Required</th><th style="text-align:left;">Description &amp; Examples</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>pattern</strong></td><td style="text-align:left;">Yes</td><td style="text-align:left;">Expression used to match the request URL.<br>• Supports domains, paths, wildcards, regular expressions.<br>• See <a href="./pattern.html">Matching Pattern Documentation</a> for details.</td></tr><tr><td style="text-align:left;"><strong>filename</strong></td><td style="text-align:left;">Yes</td><td style="text-align:left;">The filename displayed during download.<br>• Examples: <code>document.pdf</code>, <code>export.xlsx</code>.<br>• Can be specified via the three methods above (inline/embedded/Values).<br>• ⚠️ Loading from files or remote URLs is not supported.</td></tr><tr><td style="text-align:left;"><strong>lineProps</strong></td><td style="text-align:left;">No</td><td style="text-align:left;">Sets additional properties for the rule.<br>• Example: <code>lineProps://important</code> can increase this rule&#39;s priority.<br>• See <a href="./lineProps.html">lineProps Documentation</a> for details.</td></tr><tr><td style="text-align:left;"><strong>filters</strong></td><td style="text-align:left;">No</td><td style="text-align:left;">Optional filter conditions for precise control over when the rule takes effect.<br>• Can match request URL, method, headers, body content.<br>• Can match response status code, headers.<br>• See <a href="./filters.html">Filters Documentation</a> for details.</td></tr></tbody></table><h2 id="configuration-examples" tabindex="-1">Configuration Examples <a class="header-anchor" href="#configuration-examples" aria-label="Permalink to &quot;Configuration Examples&quot;">​</a></h2><h3 id="basic-example" tabindex="-1">Basic Example <a class="header-anchor" href="#basic-example" aria-label="Permalink to &quot;Basic Example&quot;">​</a></h3><p>Make visiting the homepage of example.com automatically download a file named <code>example.html</code>.</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://www.example.com/ attachment://example.html</span></span></code></pre></div><h3 id="using-with-filters" tabindex="-1">Using with Filters <a class="header-anchor" href="#using-with-filters" aria-label="Permalink to &quot;Using with Filters&quot;">​</a></h3><p>Trigger PDF download only when the request contains a specific query parameter <code>download=true</code>.</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://api.example.com/document attachment://User-Manual.pdf includeFilter:///[?&amp;]download=true/</span></span></code></pre></div><h3 id="using-embedded-values" tabindex="-1">Using Embedded Values <a class="header-anchor" href="#using-embedded-values" aria-label="Permalink to &quot;Using Embedded Values&quot;">​</a></h3><p>Use an embedded code block for clarity when the filename is complex or needs annotation.</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://assets.example.com/data.json attachment://{my-file-name}</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>``` my-file-name</span></span>\n<span class="line"><span>Config-Backup-20240514.json</span></span>\n<span class="line"><span>```</span></span></code></pre></div><h2 id="implementing-remote-loading" tabindex="-1">Implementing Remote Loading <a class="header-anchor" href="#implementing-remote-loading" aria-label="Permalink to &quot;Implementing Remote Loading&quot;">​</a></h2><p>The <code>attachment</code> protocol itself does not support loading values from file paths or remote URLs. If remote loading functionality is needed, consider the following two alternative approaches:</p><h3 id="_1-extend-functionality-via-plugins" tabindex="-1">1. Extend Functionality via Plugins <a class="header-anchor" href="#_1-extend-functionality-via-plugins" aria-label="Permalink to &quot;1. Extend Functionality via Plugins&quot;">​</a></h3><p>You can develop a plugin to implement more complex filename retrieval logic, such as dynamically fetching filenames from a remote API. Please refer to the <a href="./../extensions/dev.html">Plugin Development Documentation</a> for specific methods.</p><h3 id="_2-using-url-to-load-complete-rules" tabindex="-1">2. Using @url to Load Complete Rules <a class="header-anchor" href="#_2-using-url-to-load-complete-rules" aria-label="Permalink to &quot;2. Using @url to Load Complete Rules&quot;">​</a></h3><p>Store the complete configuration file containing <code>attachment</code> rules on a remote server and then load the entire rule set via the <a href="./@.html"><code>@url</code></a> protocol.</p><p><strong>Example:</strong></p><ol><li>Create a rule file <code>xxx.txt</code> on a remote server:<div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://api.example.com/export attachment://remote-file.csv</span></span>\n<span class="line"><span>https://static.example.com/docs attachment://Document.pdf</span></span></code></pre></div></li><li>Reference the remote rules in the local Rules configuration:<div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@https://remote-url/xxx.txt</span></span></code></pre></div>This way, the <code>attachment</code> rules in the remote file will be loaded and take effect.</li></ol><h2 id="how-it-works-related-protocols" tabindex="-1">How It Works &amp; Related Protocols <a class="header-anchor" href="#how-it-works-related-protocols" aria-label="Permalink to &quot;How It Works &amp; Related Protocols&quot;">​</a></h2><ol><li><p><strong>Core Principle</strong>: The <code>attachment</code> protocol essentially sets response headers automatically. The example above is completely equivalent to manually setting headers using the <a href="./resHeaders.html"><code>resHeaders</code></a> protocol:</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://www.example.com/ resHeaders://content-disposition=attachment;filename=&quot;example.html&quot;</span></span></code></pre></div></li><li><p><strong>Advantage</strong>: Compared to directly using <code>resHeaders</code>, the <code>attachment</code> syntax is more concise, readable, focuses on the file download scenario, and automatically handles details like filename escaping.</p></li><li><p><strong>Note</strong>: The actual content of the response body returned by the server remains unchanged. This rule simply instructs the browser how to handle that content by modifying the response headers.</p></li></ol>',41)]))}const u=t(o,[["render",l]]);export{m as __pageData,u as default};
