import{_ as i,c as a,o as e,ag as n}from"./chunks/framework.Bw-5EFTY.js";const g=JSON.parse('{"title":"Log Rule","description":"","frontmatter":{},"headers":[],"relativePath":"en/docs/rules/log.md","filePath":"en/docs/rules/log.md"}'),t={name:"en/docs/rules/log.md"};function l(r,s,p,h,o,d){return e(),a("div",null,s[0]||(s[0]=[n(`<h1 id="log-rule" tabindex="-1">Log Rule <a class="header-anchor" href="#log-rule" aria-label="Permalink to &quot;Log Rule&quot;">​</a></h1><p>Automatically injects JavaScript code into pages to capture JavaScript exceptions and <code>console.xxx</code> logs, displaying them in real-time on the Whistle management interface.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><ul><li><strong>Exception Monitoring</strong>: Automatically captures JavaScript execution errors and unhandled Promise rejections in pages.</li><li><strong>Log Collection</strong>: Intercepts and collects all console outputs such as <code>console.log()</code>, <code>console.warn()</code>, and <code>console.error()</code>.</li><li><strong>Visual Log Viewing</strong>: View, filter, and search logs by group in real-time within the Whistle management interface.</li><li><strong>Log Preprocessing</strong>: Supports filtering or formatting log content through custom scripts.</li></ul><h2 id="rule-syntax" tabindex="-1">Rule Syntax <a class="header-anchor" href="#rule-syntax" aria-label="Permalink to &quot;Rule Syntax&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern log://id [filters...]</span></span></code></pre></div><h3 id="parameter-description" tabindex="-1">Parameter Description <a class="header-anchor" href="#parameter-description" aria-label="Permalink to &quot;Parameter Description&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Parameter</th><th>Required</th><th>Description</th><th>Details</th></tr></thead><tbody><tr><td>pattern</td><td>Yes</td><td>Expression matching request URLs to specify pages to monitor</td><td><a href="./pattern.html">Pattern Matching Syntax</a></td></tr><tr><td>id</td><td>Yes</td><td>Log group identifier (plain string) to distinguish and filter logs from different sources in the Whistle interface</td><td>Logs within the same group are displayed together, supporting quick view switching by ID</td></tr><tr><td>filters</td><td>No</td><td>Filter conditions to further match specific characteristics of requests or responses</td><td><a href="./filters.html">Filter Syntax</a> <br> Supports filtering by URL, method, request headers, response status codes, etc.</td></tr></tbody></table><h2 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;Usage&quot;">​</a></h2><h3 id="basic-usage" tabindex="-1">Basic Usage <a class="header-anchor" href="#basic-usage" aria-label="Permalink to &quot;Basic Usage&quot;">​</a></h3><p>Capture logs from all pages under a specified domain:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com log://myapp</span></span></code></pre></div><h3 id="multi-domain-group-monitoring" tabindex="-1">Multi-Domain Group Monitoring <a class="header-anchor" href="#multi-domain-group-monitoring" aria-label="Permalink to &quot;Multi-Domain Group Monitoring&quot;">​</a></h3><p>Set different log groups for different domains or paths for categorized viewing:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ke.qq.com log://ke</span></span>
<span class="line"><span>news.qq.com log://news</span></span>
<span class="line"><span>api.example.com log://api</span></span></code></pre></div><h2 id="advanced-configuration-log-preprocessing" tabindex="-1">Advanced Configuration: Log Preprocessing <a class="header-anchor" href="#advanced-configuration-log-preprocessing" aria-label="Permalink to &quot;Advanced Configuration: Log Preprocessing&quot;">​</a></h2><p>Inject custom scripts via the <code>jsPrepend</code> rule to preprocess logs before they are sent to Whistle, such as sensitive information masking, format conversion, or conditional filtering.</p><h3 id="configuration-example" tabindex="-1">Configuration Example <a class="header-anchor" href="#configuration-example" aria-label="Permalink to &quot;Configuration Example&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com log:// jsPrepend://{handleLog.js}</span></span></code></pre></div><h3 id="preprocessing-script-example" tabindex="-1">Preprocessing Script Example <a class="header-anchor" href="#preprocessing-script-example" aria-label="Permalink to &quot;Preprocessing Script Example&quot;">​</a></h3><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// handleLog.js</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Custom processing function executed before logs are sent to Whistle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onBeforeWhistleLogSend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">level</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // result: Array of raw messages to be output</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // level: Log level (&#39;log&#39;, &#39;warn&#39;, &#39;error&#39;, &#39;info&#39;, &#39;debug&#39;)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Example 1: Hide sensitive keywords</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;string&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;password&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      result[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;[SENSITIVE DATA HIDDEN]&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Example 2: Convert specific content to structured objects</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;abc&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      result[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;avenwu&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        level: level,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        timestamp: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toISOString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Example 3: Filter out certain types of logs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ignore-this-message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Returning an empty array will prevent this log from being sent</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">splice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h2 id="interface-operation-guide" tabindex="-1">Interface Operation Guide <a class="header-anchor" href="#interface-operation-guide" aria-label="Permalink to &quot;Interface Operation Guide&quot;">​</a></h2><h3 id="viewing-logs" tabindex="-1">Viewing Logs <a class="header-anchor" href="#viewing-logs" aria-label="Permalink to &quot;Viewing Logs&quot;">​</a></h3><ol><li>Open the Whistle management interface (default: <code>http://127.0.0.1:8899</code>)</li><li>Switch to the <strong>Network / Tools / Console</strong> tab</li><li>Select the corresponding log group ID in the top-left corner</li><li>View page output logs and error information in real-time</li></ol><h3 id="log-filtering" tabindex="-1">Log Filtering <a class="header-anchor" href="#log-filtering" aria-label="Permalink to &quot;Log Filtering&quot;">​</a></h3><ul><li>Use the top filter bar to quickly filter by log level (Log/Warn/Error)</li><li>Supports keyword search to quickly locate specific logs</li></ul>`,26)]))}const c=i(t,[["render",l]]);export{g as __pageData,c as default};
