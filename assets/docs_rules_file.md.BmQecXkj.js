import{_ as s,c as e,o as n,ag as t}from"./chunks/framework.Bw-5EFTY.js";const u=JSON.parse('{"title":"file","description":"","frontmatter":{},"headers":[],"relativePath":"docs/rules/file.md","filePath":"docs/rules/file.md"}'),l={name:"docs/rules/file.md"};function p(i,a,o,c,r,d){return n(),e("div",null,a[0]||(a[0]=[t(`<h1 id="file" tabindex="-1">file <a class="header-anchor" href="#file" aria-label="Permalink to &quot;file&quot;">​</a></h1><p><code>file</code> 协议用于将请求映射到本地文件系统，用本地文件的内容作为响应返回给客户端，适用于以下场景：</p><ul><li><strong>搭建本地开发环境</strong>：快速搭建本地开发服务器</li><li><strong>调试本地前端页面</strong>：直接调试本地 HTML、CSS、JavaScript 文件</li><li><strong>接口 Mock 场景</strong>：使用本地 JSON 文件模拟 API 接口响应</li><li><strong>静态资源服务</strong>：将本地目录作为静态资源服务器使用</li></ul><h2 id="规则语法" tabindex="-1">规则语法 <a class="header-anchor" href="#规则语法" aria-label="Permalink to &quot;规则语法&quot;">​</a></h2><p><code>file</code> 协议支持多种方式指定本地文件内容：</p><h3 id="_1-内联值-直接指定" tabindex="-1">1. 内联值（直接指定） <a class="header-anchor" href="#_1-内联值-直接指定" aria-label="Permalink to &quot;1. 内联值（直接指定）&quot;">​</a></h3><p>直接在规则中写明要返回的内容，适用于简短的文本内容。注意：<code>value</code> 不能包含空格和换行符。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern file://(value) [lineProps...] [filters...]</span></span></code></pre></div><p><strong>示例：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/api/data file://({&quot;status&quot;:&quot;ok&quot;})</span></span></code></pre></div><p><strong>注意：内联值必须用括号 <code>()</code> 包裹，否则会被识别为本地文件路径，可能导致 404 错误：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 正确写法：返回字符串 &quot;success&quot;</span></span>
<span class="line"><span>pattern file://(success)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 错误写法：会被当作路径处理，可能导致 404</span></span>
<span class="line"><span>pattern file://success</span></span></code></pre></div><blockquote><p><strong>file 协议的内联值语法要点</strong>：</p><ul><li>必须使用 <code>()</code> 包裹内容</li><li>内容不能包含空格和换行符</li><li>可以是字符串、JSON、HTML片段等</li><li>如果不加 <code>()</code>，Whistle 会将其解释为文件路径或 <code>{key}</code> 并尝试加载对应文件或 key 值</li></ul></blockquote><h3 id="_2-内嵌值-使用代码块" tabindex="-1">2. 内嵌值（使用代码块） <a class="header-anchor" href="#_2-内嵌值-使用代码块" aria-label="Permalink to &quot;2. 内嵌值（使用代码块）&quot;">​</a></h3><p>当需要处理包含空格、换行符的复杂内容，或希望复用某段配置时，推荐使用此方式。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern file://{custom-key.json} [lineProps...] [filters...]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` custom-key.json</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  &quot;status&quot;: &quot;success&quot;,</span></span>
<span class="line"><span>  &quot;data&quot;: {</span></span>
<span class="line"><span>    &quot;message&quot;: &quot;Hello from local file&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>\`\`\`</span></span></code></pre></div><p><strong>最佳实践</strong>：建议为 <code>key</code> 添加响应类型后缀（如 <code>.json</code>、<code>.html</code>、<code>.css</code>），Whistle 会自动根据后缀设置正确的 <code>Content-Type</code>。</p><h3 id="_3-引用-values-中的值" tabindex="-1">3. 引用 Values 中的值 <a class="header-anchor" href="#_3-引用-values-中的值" aria-label="Permalink to &quot;3. 引用 Values 中的值&quot;">​</a></h3><p>当内容较大时，可以将其存储在 <code>Values</code> 配置区中。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern file://{key-of-values.html} [lineProps...] [filters...]</span></span></code></pre></div><p><strong>前提</strong>：在 <code>Values</code> 中存在名为 <code>key-of-values.html</code> 的键，其值为要返回的内容。</p><p><strong>容量建议</strong>：</p><ul><li>小于 2KB 的内容：建议使用内联或内嵌方式</li><li>2KB 至 200KB 的内容：建议存储在 <code>Values</code> 中</li><li>大于 200KB 的内容：建议使用本地文件</li></ul><h3 id="_4-从临时文件中加载" tabindex="-1">4. 从临时文件中加载 <a class="header-anchor" href="#_4-从临时文件中加载" aria-label="Permalink to &quot;4. 从临时文件中加载&quot;">​</a></h3><p>当需要频繁编辑内容时，可以使用 Whistle 提供的临时文件功能。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern file://temp.html</span></span></code></pre></div><p><strong>操作步骤</strong>：</p><ol><li>在 Rules 编辑器中，按住 <code>Command</code>（Mac）/ <code>Ctrl</code>（Windows）</li><li>鼠标点击 <code>file://temp.html</code></li><li>在弹出的编辑对话框中输入响应内容</li><li>点击 <code>Save</code> 保存</li></ol><p>保存后规则会自动变为类似以下格式：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://example.com/report file://temp/11adb9c9e1142df67b30d7646ec59bcd34c855d9011d1a2405c7fc2dfc94568d.html</span></span></code></pre></div><p>需要再次编辑时，用同样的方式点击该临时文件链接即可。</p><h3 id="_5-从文件路径或远程-url-加载" tabindex="-1">5. 从文件路径或远程 URL 加载 <a class="header-anchor" href="#_5-从文件路径或远程-url-加载" aria-label="Permalink to &quot;5. 从文件路径或远程 URL 加载&quot;">​</a></h3><p>从本地文件系统或远程 URL 加载响应内容。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 从本地文件加载</span></span>
<span class="line"><span>pattern file:///User/xxx/test.html</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 从远程 URL 加载</span></span>
<span class="line"><span>pattern file://https://example.com/template.html</span></span></code></pre></div><h2 id="参数详解" tabindex="-1">参数详解 <a class="header-anchor" href="#参数详解" aria-label="Permalink to &quot;参数详解&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">是否必填</th><th style="text-align:left;">描述与示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>pattern</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">用于匹配请求 URL 的表达式。<br>• 支持域名、路径、通配符、正则表达式。<br>• 详见 <a href="./pattern.html">匹配模式文档</a>。</td></tr><tr><td style="text-align:left;"><strong>value</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">要返回的文件内容或路径，支持多种格式：<br>• 本地文件或目录路径<br>• 远程 URL<br>• 内联、内嵌、Values 引用内容</td></tr><tr><td style="text-align:left;"><strong>lineProps</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">为规则设置附加属性。<br><strong>示例</strong>：<br>• <code>lineProps://important</code>：提升规则优先级<br>• <code>lineProps://weakRule</code>：当同时配置 <a href="./file.html">file</a> 和 <a href="./proxy.html">proxy</a> 规则时，默认 <a href="./proxy.html">proxy</a> 会失效。通过此属性可提升 <a href="./proxy.html">proxy</a> 规则的优先级。<br>• 详见 <a href="./lineProps.html">lineProps 文档</a>。</td></tr><tr><td style="text-align:left;"><strong>filters</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">可选的过滤条件，用于精确控制规则生效的场景。<br>• 可匹配请求的 URL、方法、头部、体内容。<br>• 可匹配响应的状态码、头部。<br>• 详见 <a href="./filters.html">过滤器文档</a>。</td></tr></tbody></table><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h2><h3 id="_1-基础文件路径映射" tabindex="-1">1. 基础文件路径映射 <a class="header-anchor" href="#_1-基础文件路径映射" aria-label="Permalink to &quot;1. 基础文件路径映射&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 将域名映射到本地目录</span></span>
<span class="line"><span>www.example.com/path file:///Users/username/projects/my-site</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Windows 系统路径</span></span>
<span class="line"><span>www.example.com/path file://D:\\projects\\my-site</span></span></code></pre></div><p><strong>特性说明</strong>：</p><ul><li><strong>自动路径拼接</strong>：访问 <code>https://www.example.com/path/x/y/z</code> 会映射到 <code>/Users/username/projects/my-site/x/y/z</code></li><li><strong>禁用路径拼接</strong>：使用 <code>&lt; &gt;</code> 包裹路径可以禁用自动拼接<div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/path file://&lt;/Users/username/projects/my-site/index.html&gt;</span></span></code></pre></div><blockquote><p>访问 <code>https://www.example.com/path/x/y/z</code> 只会返回 <code>/Users/username/projects/my-site/index.html</code> 文件</p></blockquote></li></ul><h3 id="_2-jsonp-接口-mock" tabindex="-1">2. JSONP 接口 Mock <a class="header-anchor" href="#_2-jsonp-接口-mock" aria-label="Permalink to &quot;2. JSONP 接口 Mock&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 内联方式</span></span>
<span class="line"><span>www.example.com/jsonp file://\`(\${query.callback}({&quot;status&quot;:&quot;ok&quot;}))\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 内嵌方式</span></span>
<span class="line"><span>\`\`\` jsonp-response</span></span>
<span class="line"><span>\${query.callback}({</span></span>
<span class="line"><span>  &quot;status&quot;: &quot;error&quot;,</span></span>
<span class="line"><span>  &quot;message&quot;: &quot;Invalid parameter&quot;</span></span>
<span class="line"><span>})</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span>www.example.com/jsonp file://\`{jsonp-response}\`</span></span></code></pre></div><blockquote><p><strong>模板字符串限制</strong>：模板字符串在以下场景无法直接生效：</p><ul><li>引用本地文件路径时</li><li>引用远程 URL 地址时</li></ul><p>遇到上述限制时，可以使用 <a href="./tpl.html">tpl</a> 协议作为替代方案。</p></blockquote><h3 id="_3-配合过滤器使用" tabindex="-1">3. 配合过滤器使用 <a class="header-anchor" href="#_3-配合过滤器使用" aria-label="Permalink to &quot;3. 配合过滤器使用&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 排除特定接口</span></span>
<span class="line"><span>www.example.com/api/path file:///Users/username/mock-data excludeFilter://*/api/auth</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 根据请求体内容匹配</span></span>
<span class="line"><span>www.example.com/api/search file:///Users/username/search-results.json includeFilter://b:/&quot;type&quot;:\\s*&quot;advanced&quot;/i</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 仅匹配 POST 请求</span></span>
<span class="line"><span>www.example.com/api/submit file:///Users/username/success.json includeFilter://m:POST</span></span></code></pre></div><h3 id="_4-多目录搜索" tabindex="-1">4. 多目录搜索 <a class="header-anchor" href="#_4-多目录搜索" aria-label="Permalink to &quot;4. 多目录搜索&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 多个文件或目录用 \`|\` 分隔</span></span>
<span class="line"><span>www.example.com/static/path file:///path/to/project1|/path/to/project2|/path/to/project3</span></span></code></pre></div><p><strong>查找逻辑</strong>：</p><ol><li>按顺序检查每个目录 <ul><li><code>/path/to/project1/static/file.js</code></li><li><code>/path/to/project2/static/file.js</code></li><li><code>/path/to/project3/static/file.js</code></li></ul></li><li>找到第一个存在的文件立即返回</li><li>全部未找到时返回 <code>404 Not Found</code></li></ol><h2 id="高级用法" tabindex="-1">高级用法 <a class="header-anchor" href="#高级用法" aria-label="Permalink to &quot;高级用法&quot;">​</a></h2><h3 id="动态路径处理" tabindex="-1">动态路径处理 <a class="header-anchor" href="#动态路径处理" aria-label="Permalink to &quot;动态路径处理&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 使用正则表达式捕获组</span></span>
<span class="line"><span>/^https?://www\\.example\\.com/user/(\\d+)/profile file:///Users/username/mock/profiles/user-$1.json</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 如果不限制数字，可以用通配符</span></span>
<span class="line"><span>^www.example.com/user/*/profile file:///Users/username/mock/profiles/user-$1.json</span></span></code></pre></div><h3 id="环境特定配置" tabindex="-1">环境特定配置 <a class="header-anchor" href="#环境特定配置" aria-label="Permalink to &quot;环境特定配置&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\`\`\` dev-config</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  &quot;apiBase&quot;: &quot;http://localhost:3000&quot;,</span></span>
<span class="line"><span>  &quot;debugMode&quot;: true</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` prod-config</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  &quot;apiBase&quot;: &quot;https://api.example.com&quot;,</span></span>
<span class="line"><span>  &quot;debugMode&quot;: false</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 通过 cookie：env=dev 判断是否为开发环境</span></span>
<span class="line"><span>www.example.com/config file://{dev-config} includeFilter://reqH:cookie=/env=dev/</span></span>
<span class="line"><span>www.example.com/config file://{prod-config} # 默认正式环境</span></span></code></pre></div><h3 id="组合使用其他协议" tabindex="-1">组合使用其他协议 <a class="header-anchor" href="#组合使用其他协议" aria-label="Permalink to &quot;组合使用其他协议&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 先使用 file 提供静态文件，再设置响应头</span></span>
<span class="line"><span>www.example.com file:///Users/username/static-files cache://3600</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 对于不存在的文件，使用 xfile 允许请求继续</span></span>
<span class="line"><span>www.example.com xfile:///Users/username/static-files</span></span></code></pre></div><h2 id="关联协议" tabindex="-1">关联协议 <a class="header-anchor" href="#关联协议" aria-label="Permalink to &quot;关联协议&quot;">​</a></h2><ol><li><p><strong>允许未匹配文件继续访问</strong>：<a href="./xfile.html">xfile</a></p><ul><li>当本地文件不存在时，允许请求继续访问原始服务器</li><li>适合静态资源服务器的开发场景</li></ul></li><li><p><strong>使用远程 URL 内容替换</strong>：<a href="./https.html">https</a> 或 <a href="./http.html">http</a></p><ul><li>使用远程服务器的内容作为响应</li><li>注意：不建议使用 <code>file://https://xxx</code> 这种形式</li></ul></li><li><p><strong>域名解析重定向</strong>：<a href="./host.html">host</a></p><ul><li>修改域名解析，将请求导向指定 IP</li></ul></li><li><p><strong>模板渲染</strong>：<a href="./tpl.html">tpl</a></p><ul><li>支持更复杂的模板渲染和动态内容生成</li></ul></li></ol><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h2><h3 id="路径处理" tabindex="-1">路径处理 <a class="header-anchor" href="#路径处理" aria-label="Permalink to &quot;路径处理&quot;">​</a></h3><ol><li><strong>相对路径</strong>：除了插件内部的规则外，不建议使用相对路径。相对路径相对于 Whistle 配置文件所在目录。</li><li><strong>绝对路径</strong>：支持系统绝对路径</li><li><strong>用户目录</strong>：支持 <code>~</code> 表示用户主目录</li><li><strong>Windows 路径</strong>：支持混用 <code>/</code> 和 <code>\\</code> 作为路径分隔符</li></ol><h3 id="文件编码" tabindex="-1">文件编码 <a class="header-anchor" href="#文件编码" aria-label="Permalink to &quot;文件编码&quot;">​</a></h3><ol><li><strong>文本文件</strong>：默认使用 UTF-8 编码</li><li><strong>编码问题</strong>：如遇乱码，请检查文件的实际编码格式</li></ol><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to &quot;故障排除&quot;">​</a></h2><h3 id="q-文件未找到-404" tabindex="-1">Q: 文件未找到（404） <a class="header-anchor" href="#q-文件未找到-404" aria-label="Permalink to &quot;Q: 文件未找到（404）&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>文件路径是否正确</li><li>文件是否存在且有读取权限</li><li>是否使用了 <code>&lt; &gt;</code> 禁用了路径拼接</li></ol><h3 id="q-乱码问题" tabindex="-1">Q: 乱码问题 <a class="header-anchor" href="#q-乱码问题" aria-label="Permalink to &quot;Q: 乱码问题&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>文件的实际编码格式</li><li>响应头的 <code>Content-Type</code> 是否正确</li><li>文件内容是否包含非法字符</li></ol><h3 id="q-规则未生效" tabindex="-1">Q: 规则未生效 <a class="header-anchor" href="#q-规则未生效" aria-label="Permalink to &quot;Q: 规则未生效&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>规则 pattern 是否正确匹配</li><li>是否有其他规则覆盖</li><li>过滤器条件是否满足</li></ol><h3 id="q-模板字符串不生效" tabindex="-1">Q: 模板字符串不生效 <a class="header-anchor" href="#q-模板字符串不生效" aria-label="Permalink to &quot;Q: 模板字符串不生效&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>是否在文件路径或远程 URL 场景下使用模板字符串</li><li>如果是，请改用 <a href="./tpl.html">tpl</a> 协议</li></ol><h2 id="扩展阅读" tabindex="-1">扩展阅读 <a class="header-anchor" href="#扩展阅读" aria-label="Permalink to &quot;扩展阅读&quot;">​</a></h2><ul><li><a href="./pattern.html">匹配模式文档</a>：详细了解 URL 匹配规则</li><li><a href="./operation.html">操作指令文档</a>：了解内容加载的多种方式</li><li><a href="./lineProps.html">附加配置</a>：详细了解一些特殊功能</li><li><a href="./filters.html">过滤器</a>：了解更多过滤器功能</li></ul>`,79)]))}const g=s(l,[["render",p]]);export{u as __pageData,g as default};
