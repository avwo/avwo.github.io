import{_ as t,c as e,o as s,ag as l}from"./chunks/framework.Bw-5EFTY.js";const u=JSON.parse('{"title":"statusCode","description":"","frontmatter":{},"headers":[],"relativePath":"docs/rules/statusCode.md","filePath":"docs/rules/statusCode.md"}'),n={name:"docs/rules/statusCode.md"};function i(o,a,p,d,r,c){return s(),e("div",null,a[0]||(a[0]=[l(`<h1 id="statuscode" tabindex="-1">statusCode <a class="header-anchor" href="#statuscode" aria-label="Permalink to &quot;statusCode&quot;">​</a></h1><p><code>statusCode</code> 协议用于立即中断请求并返回指定的 HTTP 状态码，不会将请求转发到后端服务器。通过 <code>statusCode</code> 协议，你可以：</p><ul><li><strong>快速模拟特定 HTTP 状态码</strong>：无需真实服务器即可测试各种状态码响应</li><li><strong>拦截并中断请求</strong>：在请求到达真实服务器前直接返回状态码</li><li><strong>测试错误场景</strong>：模拟服务器错误、重定向、认证失败等场景</li><li><strong>控制请求流程</strong>：根据条件决定是否允许请求继续</li></ul><h2 id="规则语法" tabindex="-1">规则语法 <a class="header-anchor" href="#规则语法" aria-label="Permalink to &quot;规则语法&quot;">​</a></h2><p><code>statusCode</code> 协议支持多种方式配置：</p><h3 id="_1-内联值-直接指定" tabindex="-1">1. 内联值（直接指定） <a class="header-anchor" href="#_1-内联值-直接指定" aria-label="Permalink to &quot;1. 内联值（直接指定）&quot;">​</a></h3><p>直接在规则中写明要返回的状态码。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern statusCode://code [lineProps...] [filters...]</span></span></code></pre></div><p><strong>示例：</strong></p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/api/old-endpoint statusCode://410</span></span></code></pre></div><h3 id="_2-内嵌值-使用代码块" tabindex="-1">2. 内嵌值（使用代码块） <a class="header-anchor" href="#_2-内嵌值-使用代码块" aria-label="Permalink to &quot;2. 内嵌值（使用代码块）&quot;">​</a></h3><p>当需要根据条件返回不同状态码，或希望复用配置时可使用此方式。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern statusCode://{custom-key} [lineProps...] [filters...]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>\`\`\` custom-key</span></span>
<span class="line"><span>404</span></span>
<span class="line"><span>\`\`\`</span></span></code></pre></div><h3 id="_3-引用-values-中的值" tabindex="-1">3. 引用 Values 中的值 <a class="header-anchor" href="#_3-引用-values-中的值" aria-label="Permalink to &quot;3. 引用 Values 中的值&quot;">​</a></h3><p>引用在界面 <code>Values</code>（中央配置区）中预先定义好的状态码。</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pattern statusCode://{key-of-values} [lineProps...] [filters...]</span></span></code></pre></div><p><strong>前提</strong>：在 <code>Values</code> 中存在名为 <code>key-of-values</code> 的键，其值为状态码。</p><h3 id="_4-文件-远程-url-加载" tabindex="-1">4. 文件/远程 URL 加载 <a class="header-anchor" href="#_4-文件-远程-url-加载" aria-label="Permalink to &quot;4. 文件/远程 URL 加载&quot;">​</a></h3><p><strong>当前不支持</strong> 从本地文件或远程 URL 动态加载内容。</p><h2 id="参数详解" tabindex="-1">参数详解 <a class="header-anchor" href="#参数详解" aria-label="Permalink to &quot;参数详解&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">是否必填</th><th style="text-align:left;">描述与示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>pattern</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">用于匹配请求 URL 的表达式。<br>• 支持域名、路径、通配符、正则表达式。<br>• 详见 <a href="./pattern.html">匹配模式文档</a>。</td></tr><tr><td style="text-align:left;"><strong>code</strong></td><td style="text-align:left;">是</td><td style="text-align:left;">HTTP 响应状态码，如：<br>• <code>200</code> OK<br>• <code>301</code> 永久重定向<br>• <code>302</code> 临时重定向<br>• <code>404</code> 未找到<br>• <code>500</code> 服务器错误<br>• 支持所有标准 HTTP 状态码</td></tr><tr><td style="text-align:left;"><strong>lineProps</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">为规则设置附加属性。<br>• 例如：<code>lineProps://important</code> 可提升此规则的优先级。<br>• 详见 <a href="./lineProps.html">lineProps 文档</a>。</td></tr><tr><td style="text-align:left;"><strong>filters</strong></td><td style="text-align:left;">否</td><td style="text-align:left;">可选的过滤条件，用于精确控制规则生效的场景。<br>• 可匹配请求的 URL、方法、头部、体内容。<br>• 可匹配响应的状态码、头部。<br>• 详见 <a href="./filters.html">过滤器文档</a>。</td></tr></tbody></table><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h2><h3 id="基础示例" tabindex="-1">基础示例 <a class="header-anchor" href="#基础示例" aria-label="Permalink to &quot;基础示例&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 返回 404 状态码（页面未找到）</span></span>
<span class="line"><span>www.example.com/deleted-page statusCode://404</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 返回 500 状态码（服务器内部错误）</span></span>
<span class="line"><span>www.example.com/api/error statusCode://500</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 返回 302 重定向</span></span>
<span class="line"><span>www.example.com/old-url statusCode://302</span></span></code></pre></div><h3 id="模拟认证失败" tabindex="-1">模拟认证失败 <a class="header-anchor" href="#模拟认证失败" aria-label="Permalink to &quot;模拟认证失败&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 访问时需要认证，浏览器会弹出登录框</span></span>
<span class="line"><span>www.example.com/secure-area statusCode://401</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 禁止弹出登录框，直接返回 401</span></span>
<span class="line"><span>www.example.com/secure-area statusCode://401 disable://userLogin</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 或使用 lineProps 达到同样效果</span></span>
<span class="line"><span>www.example.com/secure-area statusCode://401 lineProps://disableUserLogin</span></span></code></pre></div><h3 id="配合自定义响应内容" tabindex="-1">配合自定义响应内容 <a class="header-anchor" href="#配合自定义响应内容" aria-label="Permalink to &quot;配合自定义响应内容&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 返回 404 状态码并自定义响应内容</span></span>
<span class="line"><span>www.example.com/missing-page statusCode://404 resBody://(&lt;h1&gt;页面不存在&lt;/h1&gt;)</span></span></code></pre></div><h3 id="配合过滤器使用" tabindex="-1">配合过滤器使用 <a class="header-anchor" href="#配合过滤器使用" aria-label="Permalink to &quot;配合过滤器使用&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 仅对特定请求方法返回 405（方法不允许）</span></span>
<span class="line"><span>www.example.com/api/resource statusCode://405 includeFilter://m:PUT</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 根据请求路径匹配返回不同状态码</span></span>
<span class="line"><span>/^https?://www\\.example\\.com/user/\\d+/profile/ statusCode://403</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 基于请求头条件返回状态码</span></span>
<span class="line"><span>www.example.com/api statusCode://429 includeFilter://reqH:user-agent=/bot/i</span></span></code></pre></div><h3 id="使用内嵌值" tabindex="-1">使用内嵌值 <a class="header-anchor" href="#使用内嵌值" aria-label="Permalink to &quot;使用内嵌值&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\`\`\` maintenance-status</span></span>
<span class="line"><span>503</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>www.example.com statusCode://{maintenance-status}</span></span></code></pre></div><h3 id="环境特定配置" tabindex="-1">环境特定配置 <a class="header-anchor" href="#环境特定配置" aria-label="Permalink to &quot;环境特定配置&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\`\`\` testing-403</span></span>
<span class="line"><span>403</span></span>
<span class="line"><span>\`\`\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 仅在测试环境返回 403</span></span>
<span class="line"><span>test.example.com/api/admin statusCode://{testing-403}</span></span></code></pre></div><h2 id="常见状态码场景" tabindex="-1">常见状态码场景 <a class="header-anchor" href="#常见状态码场景" aria-label="Permalink to &quot;常见状态码场景&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">状态码</th><th style="text-align:left;">场景描述</th><th style="text-align:left;">典型使用</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>200</strong></td><td style="text-align:left;">成功响应</td><td style="text-align:left;">测试正常流程</td></tr><tr><td style="text-align:left;"><strong>301/302</strong></td><td style="text-align:left;">重定向</td><td style="text-align:left;">测试 URL 跳转逻辑</td></tr><tr><td style="text-align:left;"><strong>400</strong></td><td style="text-align:left;">错误请求</td><td style="text-align:left;">测试客户端错误处理</td></tr><tr><td style="text-align:left;"><strong>401</strong></td><td style="text-align:left;">未认证</td><td style="text-align:left;">测试认证流程</td></tr><tr><td style="text-align:left;"><strong>403</strong></td><td style="text-align:left;">禁止访问</td><td style="text-align:left;">测试权限控制</td></tr><tr><td style="text-align:left;"><strong>404</strong></td><td style="text-align:left;">未找到</td><td style="text-align:left;">测试资源不存在处理</td></tr><tr><td style="text-align:left;"><strong>429</strong></td><td style="text-align:left;">请求过多</td><td style="text-align:left;">测试限流逻辑</td></tr><tr><td style="text-align:left;"><strong>500</strong></td><td style="text-align:left;">服务器错误</td><td style="text-align:left;">测试服务端异常处理</td></tr><tr><td style="text-align:left;"><strong>503</strong></td><td style="text-align:left;">服务不可用</td><td style="text-align:left;">测试维护页面</td></tr></tbody></table><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h2><h3 id="_1-响应内容" tabindex="-1">1. 响应内容 <a class="header-anchor" href="#_1-响应内容" aria-label="Permalink to &quot;1. 响应内容&quot;">​</a></h3><ul><li>默认情况下，<code>statusCode</code> 返回的响应内容为空</li><li>可通过配合 <a href="./resBody.html"><code>resBody</code></a> 协议自定义响应内容</li></ul><h3 id="_2-认证弹窗控制" tabindex="-1">2. 认证弹窗控制 <a class="header-anchor" href="#_2-认证弹窗控制" aria-label="Permalink to &quot;2. 认证弹窗控制&quot;">​</a></h3><ul><li>返回 <code>401</code> 状态码时，默认会触发浏览器认证弹窗</li><li>可通过以下方式禁用弹窗： <ul><li>添加 <code>disable://userLogin</code></li><li>添加 <code>lineProps://disableUserLogin</code></li><li>使用 <a href="./enable.html"><code>enable</code></a> 协议的反向配置</li></ul></li></ul><h3 id="_3-重定向处理" tabindex="-1">3. 重定向处理 <a class="header-anchor" href="#_3-重定向处理" aria-label="Permalink to &quot;3. 重定向处理&quot;">​</a></h3><ul><li>返回 <code>301</code>、<code>302</code> 等重定向状态码时，需配合 <a href="./resHeaders.html"><code>location</code></a> 响应头指定重定向地址：<div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>www.example.com/old statusCode://302 resHeaders://location=&quot;https://www.example.com/new&quot;</span></span></code></pre></div></li></ul><h2 id="高级用法" tabindex="-1">高级用法 <a class="header-anchor" href="#高级用法" aria-label="Permalink to &quot;高级用法&quot;">​</a></h2><h3 id="动态状态码" tabindex="-1">动态状态码 <a class="header-anchor" href="#动态状态码" aria-label="Permalink to &quot;动态状态码&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 基于时间返回不同状态码（维护窗口）</span></span>
<span class="line"><span>www.example.com/api statusCode://503 includeFilter://t:&gt;=00:00&amp;t:&lt;=06:00</span></span></code></pre></div><h3 id="组合使用其他协议" tabindex="-1">组合使用其他协议 <a class="header-anchor" href="#组合使用其他协议" aria-label="Permalink to &quot;组合使用其他协议&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 返回 403 并设置自定义错误页面</span></span>
<span class="line"><span>www.example.com/blocked statusCode://403 resBody://&lt;h1&gt;访问被拒绝&lt;/h1&gt; resHeaders://content-type=&quot;text/html; charset=utf-8&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 返回 503 并设置重试时间</span></span>
<span class="line"><span>www.example.com/down statusCode://503 resHeaders://retry-after=&quot;3600&quot;</span></span></code></pre></div><h3 id="测试客户端容错" tabindex="-1">测试客户端容错 <a class="header-anchor" href="#测试客户端容错" aria-label="Permalink to &quot;测试客户端容错&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 随机返回不同错误状态码，测试客户端容错能力</span></span>
<span class="line"><span>www.example.com/api/unstable statusCode://500 includeFilter://chance:0.5</span></span>
<span class="line"><span>www.example.com/api/unstable statusCode://429 includeFilter://chance:0.3</span></span>
<span class="line"><span>www.example.com/api/unstable statusCode://200 includeFilter://chance:0.2</span></span></code></pre></div><h2 id="与-replacestatus-的区别" tabindex="-1">与 replaceStatus 的区别 <a class="header-anchor" href="#与-replacestatus-的区别" aria-label="Permalink to &quot;与 replaceStatus 的区别&quot;">​</a></h2><ul><li><strong><code>statusCode</code></strong>：在请求阶段生效，<strong>不会转发到后端服务器</strong></li><li><strong><code>replaceStatus</code></strong>：在响应阶段生效，<strong>会先请求后端服务器</strong>，然后替换返回的状态码</li></ul><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to &quot;故障排除&quot;">​</a></h2><h3 id="q-状态码规则没有生效" tabindex="-1">Q: 状态码规则没有生效 <a class="header-anchor" href="#q-状态码规则没有生效" aria-label="Permalink to &quot;Q: 状态码规则没有生效&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>规则 pattern 是否正确匹配请求 URL</li><li>是否有其他更高优先级的规则覆盖</li><li>过滤器条件是否满足</li></ol><h3 id="q-浏览器弹出认证窗口" tabindex="-1">Q: 浏览器弹出认证窗口 <a class="header-anchor" href="#q-浏览器弹出认证窗口" aria-label="Permalink to &quot;Q: 浏览器弹出认证窗口&quot;">​</a></h3><p><strong>A:</strong> 对于 401 状态码：</p><ol><li>检查是否添加了 <code>disable://userLogin</code> 或 <code>lineProps://disableUserLogin</code></li><li>确认规则顺序是否正确</li></ol><h3 id="q-客户端显示空白页面" tabindex="-1">Q: 客户端显示空白页面 <a class="header-anchor" href="#q-客户端显示空白页面" aria-label="Permalink to &quot;Q: 客户端显示空白页面&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>是否设置了自定义响应内容</li><li>响应头的 <code>Content-Type</code> 是否正确</li><li>响应内容编码是否匹配</li></ol><h3 id="q-重定向未生效" tabindex="-1">Q: 重定向未生效 <a class="header-anchor" href="#q-重定向未生效" aria-label="Permalink to &quot;Q: 重定向未生效&quot;">​</a></h3><p><strong>A:</strong> 检查：</p><ol><li>是否设置了 <code>Location</code> 响应头</li><li>重定向地址格式是否正确</li><li>浏览器是否遵循重定向规则</li></ol><h2 id="关联协议" tabindex="-1">关联协议 <a class="header-anchor" href="#关联协议" aria-label="Permalink to &quot;关联协议&quot;">​</a></h2><ol><li><p><strong>替换响应状态码</strong>：<a href="./replaceStatus.html">replaceStatus</a></p><ul><li>请求先到达服务器，然后替换返回的状态码</li></ul></li><li><p><strong>禁止认证弹窗</strong>：<a href="./disable.html">disable</a> 或 <a href="./lineProps.html">lineProps</a></p><ul><li>禁用 401 状态码触发的浏览器登录弹窗</li></ul></li><li><p><strong>设置响应内容</strong>：<a href="./resBody.html">resBody</a></p><ul><li>为状态码响应添加自定义内容</li></ul></li><li><p><strong>设置响应头</strong>：<a href="./resHeaders.html">resHeaders</a></p><ul><li>为重定向等场景设置必要的响应头</li></ul></li></ol><h2 id="扩展阅读" tabindex="-1">扩展阅读 <a class="header-anchor" href="#扩展阅读" aria-label="Permalink to &quot;扩展阅读&quot;">​</a></h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status" target="_blank" rel="noreferrer">HTTP 状态码 MDN 文档</a>：了解所有 HTTP 状态码的含义</li><li><a href="./pattern.html">匹配模式文档</a>：详细了解 URL 匹配规则</li><li><a href="./filters.html">过滤器文档</a>：了解更多过滤器功能</li></ul>`,69)]))}const g=t(n,[["render",i]]);export{u as __pageData,g as default};
